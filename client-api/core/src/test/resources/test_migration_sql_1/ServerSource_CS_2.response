{"CSharpServer/.cs":"\r\nnamespace _DatabaseCommon\r\n{\r\n\tusing System;\r\n\tusing System.Collections;\r\n\tusing System.Collections.Generic;\r\n\r\n\tinternal static partial class Utility\r\n\t{\r\n\t\tpublic static T[] ConvertToArray<T>(List<T> source)\r\n\t\t{\r\n\t\t\treturn source != null ? source.ToArray() : null;\r\n\t\t}\r\n\t\tpublic static List<T> ConvertToList<T>(List<T> source)\r\n\t\t{\r\n\t\t\treturn source;\r\n\t\t}\r\n\t\tpublic static HashSet<T> ConvertToSet<T>(List<T> source)\r\n\t\t{\r\n\t\t\treturn source != null ? new HashSet<T>(source) : null;\r\n\t\t}\r\n\t}\r\n}\r\nnamespace _DatabaseCommon\r\n{\r\n\tusing System.Collections.Generic;\r\n\tusing System.IO;\r\n\tusing System.Text;\r\n\tusing NGS.DatabasePersistence.Postgres;\r\n\tusing NGS.DatabasePersistence.Postgres.Converters;\r\n\r\n\tinternal static partial class Utility\r\n\t{\r\n\t\tpublic static int? ToNullableInt(this string value)\r\n\t\t{\r\n\t\t\tif(!string.IsNullOrWhiteSpace(value))\r\n\t\t\t\treturn int.Parse(value, System.Globalization.CultureInfo.InvariantCulture);\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tpublic static string NullableIntegerToString(int? value)\r\n\t\t{\r\n\t\t\tif(value.HasValue)\r\n\t\t\t\treturn value.Value.ToString(System.Globalization.CultureInfo.InvariantCulture);\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tpublic static ValueTuple NullableIntegerToTuple(int? value)\r\n\t\t{\r\n\t\t\treturn value != null ? new ValueTuple(value.Value.ToString(System.Globalization.CultureInfo.InvariantCulture), false, false) : null;\r\n\t\t}\r\n\r\n\t\tpublic static int? ParseNullableInt(TextReader reader, int context)\r\n\t\t{\r\n\t\t\treturn IntConverter.ParseNullable(reader);\r\n\t\t}\r\n\r\n\t\tpublic static List<int?> ParseNullableListInt(TextReader reader, int context)\r\n\t\t{\r\n\t\t\treturn IntConverter.ParseNullableCollection(reader, context);\r\n\t\t}\r\n\t}\r\n}\r\nnamespace _DatabaseCommon\r\n{\r\n\tusing System.Collections.Generic;\r\n\tusing System.IO;\r\n\tusing System.Text;\r\n\tusing NGS.DatabasePersistence.Postgres;\r\n\tusing NGS.DatabasePersistence.Postgres.Converters;\r\n\r\n\tinternal static partial class Utility\r\n\t{\r\n\t\tpublic static int ToInt(this string value)\r\n\t\t{\r\n\t\t\tif(!string.IsNullOrWhiteSpace(value))\r\n\t\t\t\treturn int.Parse(value, System.Globalization.CultureInfo.InvariantCulture);\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\tpublic static string IntegerToString(int value)\r\n\t\t{\r\n\t\t\treturn value.ToString(System.Globalization.CultureInfo.InvariantCulture);\r\n\t\t}\r\n\r\n\t\tpublic static ValueTuple IntegerToTuple(int value)\r\n\t\t{\r\n\t\t\treturn new ValueTuple(value.ToString(System.Globalization.CultureInfo.InvariantCulture), false, false);\r\n\t\t}\r\n\r\n\t\tpublic static int ParseInt(TextReader reader, int context)\r\n\t\t{\r\n\t\t\treturn IntConverter.Parse(reader);\r\n\t\t}\r\n\r\n\t\tpublic static List<int> ParseListInt(TextReader reader, int context)\r\n\t\t{\r\n\t\t\treturn IntConverter.ParseCollection(reader, context);\r\n\t\t}\r\n\t}\r\n}\r\nnamespace _DatabaseCommon\r\n{\r\n\tusing System.Collections.Generic;\r\n\tusing System.IO;\r\n\tusing System.Text;\r\n\tusing NGS.DatabasePersistence.Postgres;\r\n\tusing NGS.DatabasePersistence.Postgres.Converters;\r\n\r\n\tinternal static partial class Utility\r\n\t{\r\n\t\tpublic static string FormatNullableString(string value)\r\n\t\t{\r\n\t\t\treturn value;\r\n\t\t}\r\n\r\n\t\tpublic static ValueTuple NullableStringToTuple(string value)\r\n\t\t{\r\n\t\t\treturn value != null ? new ValueTuple(value) : null;\r\n\t\t}\r\n\r\n\t\tpublic static string ParseNullableString(TextReader reader, int context)\r\n\t\t{\r\n\t\t\treturn StringConverter.Parse(reader, context);\r\n\t\t}\r\n\r\n\t\tpublic static List<string> ParseNullableListString(TextReader reader, int context)\r\n\t\t{\r\n\t\t\treturn StringConverter.ParseCollection(reader, context, true);\r\n\t\t}\r\n\t}\r\n}\r\nnamespace _DatabaseCommon\r\n{\r\n\tusing System.Collections.Generic;\r\n\tusing System.IO;\r\n\tusing System.Text;\r\n\tusing NGS.DatabasePersistence.Postgres;\r\n\tusing NGS.DatabasePersistence.Postgres.Converters;\r\n\r\n\tinternal static partial class Utility\r\n\t{\r\n\t\tpublic static string FormatString(string value)\r\n\t\t{\r\n\t\t\treturn value ?? string.Empty;\r\n\t\t}\r\n\r\n\t\tpublic static ValueTuple StringToTuple(string value)\r\n\t\t{\r\n\t\t\treturn new ValueTuple(value ?? string.Empty);\r\n\t\t}\r\n\r\n\t\tpublic static string ParseString(TextReader reader, int context)\r\n\t\t{\r\n\t\t\treturn StringConverter.Parse(reader, context) ?? string.Empty;\r\n\t\t}\r\n\r\n\t\tpublic static List<string> ParseListString(TextReader reader, int context)\r\n\t\t{\r\n\t\t\treturn StringConverter.ParseCollection(reader, context, false);\r\n\t\t}\r\n\t}\r\n}\r\nnamespace _DatabaseCommon\r\n{\r\n\tusing System.Collections.Generic;\r\n\tusing System.IO;\r\n\tusing System.Text;\r\n\tusing NGS.DatabasePersistence.Postgres;\r\n\tusing NGS.DatabasePersistence.Postgres.Converters;\r\n\r\n\tinternal static partial class Utility\r\n\t{\r\n\t\tpublic static float? ToNullableFloat(this string value)\r\n\t\t{\r\n\t\t\tif(!string.IsNullOrWhiteSpace(value))\r\n\t\t\t\treturn float.Parse(value, System.Globalization.CultureInfo.InvariantCulture);\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tpublic static string NullableFloatToString(float? value)\r\n\t\t{\r\n\t\t\tif(value.HasValue)\r\n\t\t\t\treturn value.Value.ToString(System.Globalization.CultureInfo.InvariantCulture);\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tpublic static ValueTuple NullableFloatToTuple(float? value)\r\n\t\t{\r\n\t\t\treturn value != null ? new ValueTuple(value.Value.ToString(System.Globalization.CultureInfo.InvariantCulture), false, false) : null;\r\n\t\t}\r\n\r\n\t\tpublic static float? ParseNullableFloat(TextReader reader, int context)\r\n\t\t{\r\n\t\t\treturn FloatConverter.ParseNullable(reader);\r\n\t\t}\r\n\r\n\t\tpublic static List<float?> ParseNullableListFloat(TextReader reader, int context)\r\n\t\t{\r\n\t\t\treturn FloatConverter.ParseNullableCollection(reader, context);\r\n\t\t}\r\n\t}\r\n}\r\nnamespace _DatabaseCommon\r\n{\r\n\tusing System.Collections.Generic;\r\n\tusing System.IO;\r\n\tusing System.Text;\r\n\tusing NGS.DatabasePersistence.Postgres;\r\n\tusing NGS.DatabasePersistence.Postgres.Converters;\r\n\r\n\tinternal static partial class Utility\r\n\t{\r\n\t\tpublic static float ToFloat(this string value)\r\n\t\t{\r\n\t\t\tif(!string.IsNullOrWhiteSpace(value))\r\n\t\t\t\treturn float.Parse(value, System.Globalization.CultureInfo.InvariantCulture);\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\tpublic static string FloatToString(float value)\r\n\t\t{\r\n\t\t\treturn value.ToString(System.Globalization.CultureInfo.InvariantCulture);\r\n\t\t}\r\n\r\n\t\tpublic static ValueTuple FloatToTuple(float value)\r\n\t\t{\r\n\t\t\treturn new ValueTuple(value.ToString(System.Globalization.CultureInfo.InvariantCulture), false, false);\r\n\t\t}\r\n\r\n\t\tpublic static float ParseFloat(TextReader reader, int context)\r\n\t\t{\r\n\t\t\treturn FloatConverter.Parse(reader);\r\n\t\t}\r\n\r\n\t\tpublic static List<float> ParseListFloat(TextReader reader, int context)\r\n\t\t{\r\n\t\t\treturn FloatConverter.ParseCollection(reader, context);\r\n\t\t}\r\n\t}\r\n}","CSharpServer/SystemBoot.Configuration.cs":"\r\nnamespace SystemBoot\r\n{\r\n\tusing System;\r\n\tusing System.Collections.Generic;\r\n\tusing System.Linq;\r\n\tusing System.Linq.Expressions;\r\n\tusing System.Text;\r\n\tusing System.Threading;\r\n\tusing System.Runtime.Serialization;\r\n\tusing NGS;\r\n\tusing NGS.DomainPatterns;\r\n\tusing NGS.Extensibility;\r\n\r\n\tusing NGS.DatabasePersistence.Postgres.Converters;\r\n\r\n\tusing NGS.DatabasePersistence.Postgres;\r\n\r\n\tusing NGS.DatabasePersistence;\r\n\r\n\tusing System.Data;\r\n\r\n\tpublic class Configuration : ISystemAspect\r\n\t{\r\n\t\tprivate static bool IsInitialized;\r\n\r\n\t\tpublic void Initialize(IObjectFactory factory)\r\n\t\t{\r\n\t\t\tif(IsInitialized)\r\n\t\t\t\treturn;\r\n\t\t\tIsInitialized = true;\r\n\r\n\t\t\t{\r\n\t\t\t\tvar dbTranConf = factory.Resolve<NGS.DatabasePersistence.IDatabaseQueryManager>();\r\n\t\t\t\tvar dbQuery = dbTranConf.CreateQuery();\r\n\t\t\t\tvar columnsInfo = dbQuery.Fill(@\"SELECT * FROM \"\"-NGS-\"\".Load_Type_Info()\");\r\n\t\t\t\tcolumnsInfo.CaseSensitive = true;\r\n\t\t\t\tcolumnsInfo.PrimaryKey = new[] { columnsInfo.Columns[0], columnsInfo.Columns[1], columnsInfo.Columns[2] };\r\n\t\t\t\t_DatabaseConfiguration.DatabaseConverters.Initialize(columnsInfo);\r\n\t\t\t\tdbTranConf.EndQuery(dbQuery, false);\r\n\t\t\t}\r\n\t\t\tvar postgresConverter = factory.Resolve<NGS.DatabasePersistence.Postgres.IPostgresConverterRepository>();\r\n\t\t\tpostgresConverter.RegisterConverter(typeof(myModule.A), new _DatabaseCommon.FactorymyModule_A.AConverter());\r\n\t\t\tDatabaseRepositorymyModule.RegisterA.Register(factory);\r\n\t\t\tpostgresConverter.RegisterConverter(typeof(myModule.B), new _DatabaseCommon.FactorymyModule_B.BConverter());\r\n\t\t\tDatabaseRepositorymyModule.RegisterB.Register(factory);\r\n\t\t\tpostgresConverter.RegisterConverter(typeof(myModule.snowBA), new _DatabaseCommon.FactorymyModule_snowBA.snowBAConverter());\r\n\t\t\tDatabaseRepositorymyModule.RegistersnowBA.Register(factory);\r\n\t\t}\r\n\t}\r\n}\r\n","CSharpServer/AssemblyInfo.cs":"\r\nusing System.Reflection;\r\nusing System.Runtime.CompilerServices;\r\nusing System.Runtime.InteropServices;\r\nusing System;\r\n\r\n[assembly: AssemblyTitle(\"DSL Platform generated model\")]\r\n[assembly: AssemblyDescription(\"https://dsl-platform.com/\")]\r\n[assembly: AssemblyConfiguration(\"\")]\r\n[assembly: AssemblyCompany(\"N.G.S.\")]\r\n[assembly: AssemblyProduct(\"DSL Platform\")]\r\n[assembly: AssemblyCopyright(\"Copyright Â© DSL Platform 2014\")]\r\n[assembly: AssemblyTrademark(\"\")]\r\n[assembly: AssemblyCulture(\"\")]\r\n[assembly: ComVisible(false)]\r\n[assembly: AssemblyVersion(\"2014.5.8.1952\")]\r\n[assembly: AssemblyFileVersion(\"2014.5.8.1952\")]\r\n[assembly: CLSCompliant(true)]","CSharpServer/myModule.A.cs":"\r\nnamespace myModule\r\n{\r\n\tusing System;\r\n\tusing System.Collections.Generic;\r\n\tusing System.Linq;\r\n\tusing System.Linq.Expressions;\r\n\tusing System.Text;\r\n\tusing System.Threading;\r\n\tusing System.Runtime.Serialization;\r\n\tusing NGS;\r\n\tusing NGS.DomainPatterns;\r\n\tusing NGS.Extensibility;\r\n\r\n\t[Serializable]\r\n\t[DataContract(Namespace=\"\")] public partial class A : System.ICloneable, NGS.DomainPatterns.IEntity, IEquatable<A>, NGS.DomainPatterns.IAggregateRoot, NGS.DomainPatterns.ICacheable, IChangeTracking<A>, NGS.Serialization.IJsonObject\r\n\t{\r\n\r\n\t\tpublic override string ToString()\r\n\t\t{\r\n\r\n\t\t\treturn base.ToString();\r\n\t\t}\r\n\r\n\t\t[System.Runtime.Serialization.OnDeserialized]\r\n\t\tprivate void OnDeserialized(StreamingContext context)\r\n\t\t{\r\n\r\n\t\t\tvar locator = context.Context as IServiceLocator;\r\n\t\t\tif (locator == null) return;\r\n\t\t}\r\n\r\n\t\tinternal long _InternalGetSizeApproximation()\r\n\t\t{\r\n\t\t\tlong size = 20;\r\n\t\t\treturn size;\r\n\t\t}\r\n\r\n\t\tinternal void __InternalPrepareInsert() {}\r\n\t\tinternal void __InternalPrepareUpdate() {}\r\n\t\tinternal void __InternalPrepareDelete() {}\r\n\t\tobject ICloneable.Clone() { return Clone(); }\r\n\r\n\t\tinternal void __ReapplyReferences() {}\r\n\t\t[DataMember] public string URI { get; internal set; }\r\n\r\n\t\tpublic A()\r\n\r\n\t\t{\r\n\r\n\t\t\tthis.URI = Guid.NewGuid().ToString();\r\n\t\t}\r\n\r\n\t\tbool IEquatable<IEntity>.Equals(IEntity obj)\r\n\t\t{\r\n\t\t\tvar other = obj as A;\r\n\t\t\treturn other != null\r\n\r\n\t\t\t\t&& other.ID == this.ID\r\n\t\t\t;\r\n\t\t}\r\n\r\n\t\tpublic override int GetHashCode()\r\n\t\t{\r\n\t\t\treturn this.URI != null ? this.URI.GetHashCode() : base.GetHashCode();\r\n\t\t}\r\n\r\n\t\tpublic A Clone()\r\n\t\t{\r\n\t\t\tvar item = new A\r\n\t\t\t{\r\n\t\t\t\tURI = this.URI,\r\n\r\n\t\t\t\tID = this.ID,\r\n\t\t\t\ti = this.i,\r\n\t\t\t\ts = this.s,\r\n\t\t\t\tf = this.f,\r\n\t\t\t};\r\n\r\n\t\t\treturn item;\r\n\t\t}\r\n\t\t//TODO let's leave it out for now\r\n\t\t//public override bool Equals(object other) { return Equals(other as A); }\r\n\t\tpublic bool Equals(A other)\r\n\t\t{\r\n\t\t\treturn (this as IEquatable<IEntity>).Equals(other)\r\n\t\t\t\t&& other.URI == this.URI\r\n\r\n\t\t\t\t&& other.ID == this.ID\r\n\t\t\t\t&& other.i == this.i\r\n\t\t\t\t&& other.s == this.s\r\n\t\t\t\t&& Equals(other.f, this.f)\r\n\t\t\t;\r\n\t\t}\r\n\r\n\t\t[DataMember(EmitDefaultValue=false,Name=\"ID\")]\r\n\t\tinternal int _ID  = NumberCounter<A>.GetNextTempInt();\r\n\r\n\t\tpublic int ID\r\n\t\t{\r\n\r\n\t\t\tget\r\n\t\t\t{\r\n\r\n\t\t\t\treturn this._ID;\r\n\t\t\t}\r\n\t\t\tinternal\r\n\t\t\tset\r\n\t\t\t{\r\n\r\n\t\t\t\tthis._ID = value;\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tDictionary<System.Type, IEnumerable<string>> ICacheable.GetRelationships()\r\n\t\t{\r\n\r\n\t\t\tvar result = new List<KeyValuePair<System.Type, string>>();\r\n\r\n\t\t\treturn result.GroupBy(it => it.Key).ToDictionary(it => it.Key, it => it.Select(e => e.Value));\r\n\r\n\t\t}\r\n\r\n\t\tpublic static event Action<A> Validating = a => {};\r\n\t\tpublic void Validate()\r\n\t\t{\r\n\t\t\tValidating(this);\r\n\t\t}\r\n\r\n\t\t[DataMember(EmitDefaultValue=false,Name=\"i\")]\r\n\t\tinternal int _i ;\r\n\r\n\t\tpublic int i\r\n\t\t{\r\n\r\n\t\t\tget\r\n\t\t\t{\r\n\r\n\t\t\t\treturn this._i;\r\n\t\t\t}\r\n\r\n\t\t\tset\r\n\t\t\t{\r\n\r\n\t\t\t\tthis._i = value;\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t[DataMember(EmitDefaultValue=false,Name=\"s\")]\r\n\t\tinternal string _s  = string.Empty;\r\n\r\n\t\tpublic string s\r\n\t\t{\r\n\r\n\t\t\tget\r\n\t\t\t{\r\n\r\n\t\t\t\treturn this._s;\r\n\t\t\t}\r\n\r\n\t\t\tset\r\n\t\t\t{\r\n\r\n\t\t\t\tthis._s = value;\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t[DataMember(EmitDefaultValue=false,Name=\"f\")]\r\n\t\tinternal float _f ;\r\n\r\n\t\tpublic float f\r\n\t\t{\r\n\r\n\t\t\tget\r\n\t\t\t{\r\n\r\n\t\t\t\treturn this._f;\r\n\t\t\t}\r\n\r\n\t\t\tset\r\n\t\t\t{\r\n\r\n\t\t\t\tthis._f = value;\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tinternal A __OriginalValue;\r\n\t\tA IChangeTracking<A>.GetOriginalValue()\r\n\t\t{\r\n\t\t\treturn __OriginalValue;\r\n\t\t}\r\n\r\n\t\tvoid global::NGS.Serialization.IJsonObject.Serialize(System.IO.StreamWriter sw, Action<System.IO.StreamWriter, object> serializer)\r\n\t\t{\r\n\r\n\t\t\tsw.Write('{');\r\n\t\t\t__SerializeJsonObject(sw, new char[36], serializer, false);\r\n\t\t\tsw.Write('}');\r\n\t\t}\r\n\r\n\t\tinternal void __SerializeJsonObject(System.IO.StreamWriter sw, char[] buffer, Action<System.IO.StreamWriter, object> serializer, bool hasWrittenProperty = false)\r\n\t\t{\r\n\r\n\t\t\tif(hasWrittenProperty) sw.Write(',');\r\n\t\t\tsw.Write(\"\\\"URI\\\":\");\r\n\t\t\tglobal::NGS.Serialization.Json.Converters.StringConverter.Serialize(URI, sw);\r\n\r\n\t\t\t\tvar __expID = this.ID;\r\n\t\t\t\tif (__expID != default(int))\r\n\t\t\t\t{\r\n\t\t\t\t\tsw.Write(\",\\\"ID\\\":\");\r\n\t\t\t\t\tglobal::NGS.Serialization.Json.Converters.NumberConverter.Serialize(__expID, sw, buffer);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar __expi = this.i;\r\n\t\t\t\tif (__expi != default(int))\r\n\t\t\t\t{\r\n\t\t\t\t\tsw.Write(\",\\\"i\\\":\");\r\n\t\t\t\t\tglobal::NGS.Serialization.Json.Converters.NumberConverter.Serialize(__expi, sw, buffer);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar __exps = this.s;\r\n\t\t\t\tif (__exps != default(string))\r\n\t\t\t\t{\r\n\t\t\t\t\tsw.Write(\",\\\"s\\\":\");\r\n\t\t\t\t\tglobal::NGS.Serialization.Json.Converters.StringConverter.Serialize(__exps, sw);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar __expf = this.f;\r\n\t\t\t\tif (__expf != default(float))\r\n\t\t\t\t{\r\n\t\t\t\t\tsw.Write(\",\\\"f\\\":\");\r\n\t\t\t\t\tglobal::NGS.Serialization.Json.Converters.NumberConverter.Serialize(__expf, sw, buffer);\r\n\t\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n}\r\n","CSharpServer/_DatabaseConfiguration.DatabaseConverters.cs":"\r\nnamespace _DatabaseConfiguration\r\n{\r\n\tusing System;\r\n\tusing System.Collections.Generic;\r\n\tusing System.Linq;\r\n\tusing System.Linq.Expressions;\r\n\tusing System.Text;\r\n\tusing System.Threading;\r\n\tusing System.Runtime.Serialization;\r\n\tusing NGS;\r\n\tusing NGS.DomainPatterns;\r\n\tusing NGS.Extensibility;\r\n\r\n\tinternal partial class DatabaseConverters\r\n\t{\r\n\r\n\t\tinternal static void Initialize(System.Data.DataTable columnsInfo)\r\n\t\t{\r\n\r\n\t\t\tSystem.Data.DataRow row = null;\r\n\t\t\t_DatabaseCommon.FactorymyModule_A.AConverter.InitializeProperties(columnsInfo);\r\n\t\t\t_DatabaseCommon.FactorymyModule_B.BConverter.InitializeProperties(columnsInfo);\r\n\t\t\t_DatabaseCommon.FactorymyModule_snowBA.snowBAConverter.InitializeProperties(columnsInfo);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n","CSharpServer/_DatabaseCommon.FactorymyModule_A.AConverter.cs":"\r\nnamespace _DatabaseCommon.FactorymyModule_A\r\n{\r\n\tusing System;\r\n\tusing System.Collections.Generic;\r\n\tusing System.Linq;\r\n\tusing System.Linq.Expressions;\r\n\tusing System.Text;\r\n\tusing System.Threading;\r\n\tusing System.Runtime.Serialization;\r\n\tusing NGS;\r\n\tusing NGS.DomainPatterns;\r\n\tusing NGS.Extensibility;\r\n\r\n\tusing System.Globalization;\r\n\tusing System.IO;\r\n\tusing NGS.DatabasePersistence;\r\n\tusing NGS.DatabasePersistence.Postgres;\r\n\tusing NGS.DatabasePersistence.Postgres.Converters;\r\n\tusing NGS.DomainPatterns;\r\n\tusing NGS.Utility;\r\n\r\n\tinternal class AConverter : IPostgresTypeConverter\r\n\t{\r\n\t\tpublic object CreateInstance(object value, IServiceLocator locator)\r\n\t\t{\r\n\t\t\tif (value == null)\r\n\t\t\t\treturn null;\r\n\t\t\tusing(var sr = value as System.IO.TextReader ?? new System.IO.StringReader(value as string ?? value.ToString()))\r\n\t\t\t{\r\n\t\t\t\treturn CreateFromRecord(sr, 0, locator);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tpublic PostgresTuple ToTuple(object instance)\r\n\t\t{\r\n\t\t\treturn CreateTupleFrom(instance as myModule.A);\r\n\t\t}\r\n\r\n\t\tpublic static RecordTuple CreateExtendedTupleFrom(myModule.A item)\r\n\t\t{\r\n\t\t\tif(item == null)\r\n\t\t\t\treturn null;\r\n\r\n\t\t\tvar items = new PostgresTuple[ExtendedColumnCount];\r\n\r\n\t\t\titems[ExtendedProperty_URI_Index] = new ValueTuple(item.URI);\r\n\t\t\titems[ExtendedProperty_ID_Index] = _DatabaseCommon.Utility.IntegerToTuple(item.ID);\r\n\t\t\titems[ExtendedProperty_i_Index] = _DatabaseCommon.Utility.IntegerToTuple(item.i);\r\n\t\t\titems[ExtendedProperty_s_Index] = _DatabaseCommon.Utility.StringToTuple(item.s);\r\n\t\t\titems[ExtendedProperty_f_Index] = _DatabaseCommon.Utility.FloatToTuple(item.f);\r\n\t\t\treturn new RecordTuple(items);\r\n\t\t}\r\n\r\n\t\tpublic static RecordTuple CreateTupleFrom(myModule.A item)\r\n\t\t{\r\n\t\t\tif(item == null)\r\n\t\t\t\treturn null;\r\n\r\n\t\t\tvar items = new PostgresTuple[ColumnCount];\r\n\r\n\t\t\titems[Property_URI_Index] = new ValueTuple(item.URI);\r\n\t\t\titems[Property_ID_Index] = _DatabaseCommon.Utility.IntegerToTuple(item.ID);\r\n\t\t\titems[Property_i_Index] = _DatabaseCommon.Utility.IntegerToTuple(item.i);\r\n\t\t\titems[Property_s_Index] = _DatabaseCommon.Utility.StringToTuple(item.s);\r\n\t\t\titems[Property_f_Index] = _DatabaseCommon.Utility.FloatToTuple(item.f);\r\n\t\t\treturn new RecordTuple(items);\r\n\t\t}\r\n\r\n\t\tprivate static int ColumnCount;\r\n\t\tprivate static int ExtendedColumnCount;\r\n\r\n\t\tinternal static void InitializeProperties(System.Data.DataTable columnsInfo)\r\n\t\t{\r\n\t\t\tSystem.Data.DataRow row = null;\r\n\r\n\t\t\tColumnCount = columnsInfo.Select(\"type_schema = 'myModule' AND type_name = 'A_entity'\").Length;\r\n\t\t\tExtendedColumnCount = columnsInfo.Select(\"type_schema = 'myModule' AND type_name = '-ngs_A_type-'\").Length;\r\n\r\n\t\t\tReaderConfiguration = new Action<myModule.A, TextReader, int, IServiceLocator>[ColumnCount > 0 ? ColumnCount : 1];\r\n\t\t\tReaderExtendedConfiguration = new Action<myModule.A, TextReader, int, IServiceLocator>[ExtendedColumnCount > 0 ? ExtendedColumnCount : 1];\r\n\t\t\tfor(int i = 0;i < ColumnCount; i++)\r\n\t\t\t\tReaderConfiguration[i] = (agg, tr, c, sl) => StringConverter.Skip(tr, c);\r\n\t\t\tif(ColumnCount != ReaderConfiguration.Length)\r\n\t\t\t\tReaderConfiguration[0] = (agg, tr, c, sl) => tr.Read();\r\n\t\t\tfor(int i = 0;i < ExtendedColumnCount; i++)\r\n\t\t\t\tReaderExtendedConfiguration[i] = (agg, tr, c, sl) => StringConverter.Skip(tr, c);\r\n\t\t\tif(ExtendedColumnCount != ReaderExtendedConfiguration.Length)\r\n\t\t\t\tReaderExtendedConfiguration[0] = (agg, tr, c, sl) => tr.Read();\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"A_entity\", \"URI\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column URI in type myModule.A_entity. Check if database is out of sync with code\");\r\n\t\t\tProperty_URI_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"-ngs_A_type-\", \"URI\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column URI in type myModule.A. Check if database is out of sync with code\");\r\n\t\t\tExtendedProperty_URI_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\tReaderConfiguration[Property_URI_Index] = (item, reader, context, locator) => item.URI = StringConverter.Parse(reader, context);\r\n\r\n\t\t\tReaderExtendedConfiguration[ExtendedProperty_URI_Index] = (item, reader, context, locator) => item.URI = StringConverter.Parse(reader, context);\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"A_entity\", \"ID\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column ID in type myModule.A_entity. Check if database is out of sync with code\");\r\n\t\t\tProperty_ID_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\tReaderConfiguration[Property_ID_Index] = (item, reader, context, locator) => item._ID = _DatabaseCommon.Utility.ParseInt(reader, context);\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"-ngs_A_type-\", \"ID\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column ID in type myModule.A. Check if database is out of sync with code\");\r\n\t\t\tExtendedProperty_ID_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\tReaderExtendedConfiguration[ExtendedProperty_ID_Index] = (item, reader, context, locator) => item._ID = _DatabaseCommon.Utility.ParseInt(reader, context);\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"A_entity\", \"i\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column i in type myModule.A_entity. Check if database is out of sync with code\");\r\n\t\t\tProperty_i_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\tReaderConfiguration[Property_i_Index] = (item, reader, context, locator) => item._i = _DatabaseCommon.Utility.ParseInt(reader, context);\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"-ngs_A_type-\", \"i\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column i in type myModule.A. Check if database is out of sync with code\");\r\n\t\t\tExtendedProperty_i_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\tReaderExtendedConfiguration[ExtendedProperty_i_Index] = (item, reader, context, locator) => item._i = _DatabaseCommon.Utility.ParseInt(reader, context);\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"A_entity\", \"s\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column s in type myModule.A_entity. Check if database is out of sync with code\");\r\n\t\t\tProperty_s_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\tReaderConfiguration[Property_s_Index] = (item, reader, context, locator) => item._s = _DatabaseCommon.Utility.ParseString(reader, context);\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"-ngs_A_type-\", \"s\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column s in type myModule.A. Check if database is out of sync with code\");\r\n\t\t\tExtendedProperty_s_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\tReaderExtendedConfiguration[ExtendedProperty_s_Index] = (item, reader, context, locator) => item._s = _DatabaseCommon.Utility.ParseString(reader, context);\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"A_entity\", \"f\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column f in type myModule.A_entity. Check if database is out of sync with code\");\r\n\t\t\tProperty_f_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\tReaderConfiguration[Property_f_Index] = (item, reader, context, locator) => item._f = _DatabaseCommon.Utility.ParseFloat(reader, context);\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"-ngs_A_type-\", \"f\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column f in type myModule.A. Check if database is out of sync with code\");\r\n\t\t\tExtendedProperty_f_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\tReaderExtendedConfiguration[ExtendedProperty_f_Index] = (item, reader, context, locator) => item._f = _DatabaseCommon.Utility.ParseFloat(reader, context);\r\n\r\n\t\t}\r\n\r\n\t\tprivate static Action<myModule.A, TextReader, int, IServiceLocator>[] ReaderConfiguration;\r\n\t\tprivate static Action<myModule.A, TextReader, int, IServiceLocator>[] ReaderExtendedConfiguration;\r\n\r\n\t\tpublic static myModule.A CreateFromRecord(TextReader reader, int context, IServiceLocator locator)\r\n\t\t{\r\n\t\t\tvar cur = reader.Read();\r\n\t\t\tif (cur == ',' || cur == ')')\r\n\t\t\t\treturn null;\r\n\t\t\tvar result = CreateFromRecord(reader, context, context == 0 ? 1 : context << 1, locator);\r\n\t\t\treader.Read();\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tpublic static myModule.A CreateFromRecord(TextReader reader, int outerContext, int context, IServiceLocator locator)\r\n\t\t{\r\n\t\t\tfor (int i = 0; i < outerContext; i++)\r\n\t\t\t\treader.Read();\r\n\t\t\tvar item = new myModule.A();\r\n\t\t\tforeach (var config in ReaderConfiguration)\r\n\t\t\t\tconfig(item, reader, context, locator);\r\n\t\t\tfor (int i = 0; i < outerContext; i++)\r\n\t\t\t\treader.Read();\r\n\r\n\t\t\titem.__OriginalValue = item.Clone();\r\n\t\t\treturn item;\r\n\t\t}\r\n\r\n\t\tpublic static myModule.A CreateFromExtendedRecord(TextReader reader, int context, IServiceLocator locator)\r\n\t\t{\r\n\t\t\tvar cur = reader.Read();\r\n\t\t\tif (cur == ',' || cur == ')')\r\n\t\t\t\treturn null;\r\n\t\t\tvar result = CreateFromExtendedRecord(reader, context, context == 0 ? 1 : context << 1, locator);\r\n\t\t\treader.Read();\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tpublic static myModule.A CreateFromExtendedRecord(TextReader reader, int outerContext, int context, IServiceLocator locator)\r\n\t\t{\r\n\t\t\tfor (int i = 0; i < outerContext; i++)\r\n\t\t\t\treader.Read();\r\n\t\t\tvar item = new myModule.A();\r\n\t\t\tforeach (var config in ReaderExtendedConfiguration)\r\n\t\t\t\tconfig(item, reader, context, locator);\r\n\t\t\tfor (int i = 0; i < outerContext; i++)\r\n\t\t\t\treader.Read();\r\n\r\n\t\t\titem.__OriginalValue = item.Clone();\r\n\t\t\treturn item;\r\n\t\t}\r\n\r\n\t\tprivate static int Property_URI_Index;\r\n\t\tprivate static int ExtendedProperty_URI_Index;\r\n\t\tinternal static List<int> OptionalEntityReferences = new List<int>();\r\n\t\tprivate static int Property_ID_Index;\r\n\t\tprivate static int ExtendedProperty_ID_Index;\r\n\r\n\t\tinternal static string BuildURI(int ID)\r\n\t\t{\r\n\t\t\treturn _DatabaseCommon.Utility.IntegerToString(ID);\r\n\t\t}\r\n\r\n\t\tinternal static void ParseURI(IServiceLocator locator, string URI, out int ID)\r\n\t\t{\r\n\r\n\t\t\tID = _DatabaseCommon.Utility.ToInt(URI);\r\n\t\t}\r\n\t\tprivate static int Property_i_Index;\r\n\t\tprivate static int ExtendedProperty_i_Index;\r\n\t\tprivate static int Property_s_Index;\r\n\t\tprivate static int ExtendedProperty_s_Index;\r\n\t\tprivate static int Property_f_Index;\r\n\t\tprivate static int ExtendedProperty_f_Index;\r\n\t}\r\n}\r\n","CSharpServer/DatabaseRepositorymyModule.ARepository.cs":"\r\nnamespace DatabaseRepositorymyModule\r\n{\r\n\tusing System;\r\n\tusing System.Collections.Generic;\r\n\tusing System.Linq;\r\n\tusing System.Linq.Expressions;\r\n\tusing System.Text;\r\n\tusing System.Threading;\r\n\tusing System.Runtime.Serialization;\r\n\tusing NGS;\r\n\tusing NGS.DomainPatterns;\r\n\tusing NGS.Extensibility;\r\n\r\n\tusing NGS.Utility;\r\n\tusing System.IO;\r\n\r\n\tusing NGS.DatabasePersistence;\r\n\tusing NGS.DatabasePersistence.Postgres;\r\n\tusing NGS.DatabasePersistence.Postgres.Converters;\r\n\tusing NGS.DatabasePersistence.Postgres.QueryGeneration;\r\n\r\n\tinternal static class RegisterA\r\n\t{\r\n\t\tpublic static void Register(IObjectFactory factory)\r\n\t\t{\r\n\t\t\tfactory.RegisterType(typeof(DatabaseRepositorymyModule.ARepository));\r\n\t\t\tfactory.RegisterType(typeof(DatabaseRepositorymyModule.ARepository), typeof(IQueryableRepository<myModule.A>), InstanceScope.Context);\r\n\t\t\tfactory.RegisterFunc<IQueryable<myModule.A>>(f => f.Resolve<IQueryableRepository<myModule.A>>().Query<myModule.A>(null));\r\n\r\n\t\t\tfactory.RegisterType(typeof(DatabaseRepositorymyModule.ARepository), typeof(IRepository<myModule.A>), InstanceScope.Context);\r\n\t\t\tfactory.RegisterFunc<Func<string, myModule.A>>(f => f.Resolve<IRepository<myModule.A>>().Find);\r\n\t\t\tfactory.RegisterFunc<Func<IEnumerable<string>, myModule.A[]>>(f => f.Resolve<IRepository<myModule.A>>().Find);\r\n\t\t\tfactory.RegisterType(typeof(DatabaseRepositorymyModule.ARepository), typeof(IPersistableRepository<myModule.A>), InstanceScope.Context);\r\n\t\t\tfactory.RegisterType(typeof(DatabaseRepositorymyModule.ARepository), typeof(IPersistableRepository<myModule.A>), InstanceScope.Context);\r\n\t\t\tfactory.RegisterType(typeof(DatabaseRepositorymyModule.ARepository), typeof(IAggregateRootRepository<myModule.A>), InstanceScope.Context);\r\n\r\n\t\t}\r\n\t}\r\n\r\n\tinternal partial class ARepository : IQueryableRepository<myModule.A>, System.IDisposable, IRepository<myModule.A>, IPersistableRepository<myModule.A>, IAggregateRootRepository<myModule.A>\r\n\t{\r\n\r\n\t\tprivate readonly IServiceLocator Locator;\r\n\t\tprivate readonly IDatabaseQuery DatabaseQuery;\r\n\r\n\t\tpublic ARepository(IServiceLocator locator, IDatabaseQuery query, IEagerNotification Notifications)\r\n\r\n\t\t{\r\n\r\n\t\t\tthis.Locator = locator;\r\n\t\t\tthis.DatabaseQuery = query;\r\n\r\n\t\t\tthis.Notifications = Notifications;\r\n\t\t\tDataCache = new WeakCache<myModule.A>(this);\r\n\t\t}\r\n\r\n\t\tpublic void Dispose()\r\n\t\t{\r\n\r\n\t\t\tif (!DatabaseQuery.InTransaction)\r\n\t\t\t{\r\n\t\t\t\tNotifyInfo ni;\r\n\t\t\t\twhile (NotifyQueue.TryDequeue(out ni))\r\n\t\t\t\t\tNotifications.Notify(ni);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tpublic IQueryable<myModule.A> Query<TCondition>(ISpecification<TCondition> specification)\r\n\t\t{\r\n\t\t\tif(specification != null && specification.IsSatisfied == null)\r\n\t\t\t\tthrow new ArgumentException(\"Search predicate is not specified\");\r\n\t\t\tif(specification != null && !typeof(TCondition).IsAssignableFrom(typeof(myModule.A)))\r\n\t\t\t\tthrow new ArgumentException(\"Specification is not compatible\");\r\n\r\n\t\t\tIQueryable<myModule.A> data = new Queryable<myModule.A>(new QueryExecutor(DatabaseQuery, Locator));\r\n\t\t\tbool rewritten = false;\r\n\r\n\t\t\tif(!rewritten && specification != null)\r\n\t\t\t{\r\n\t\t\t\tvar specAsNative = specification as ISpecification<myModule.A>;\r\n\t\t\t\tif(specAsNative != null)\r\n\t\t\t\t\tdata = data.Where(specAsNative.IsSatisfied);\r\n\t\t\t\telse\r\n\t\t\t\t\tdata = data.Cast<TCondition>().Where(specification.IsSatisfied).Cast<myModule.A>();\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\t\t}\r\n\r\n\t\tpublic myModule.A[] Search<TCondition>(ISpecification<TCondition> specification, int? limit, int? offset)\r\n\t\t{\r\n\t\t\tif(specification != null && specification.IsSatisfied == null)\r\n\t\t\t\tthrow new ArgumentException(\"Search predicate is not specified\");\r\n\r\n\t\t\tbool rewritten = false;\r\n\t\t\tvar result = new List<myModule.A>();\r\n\r\n\t\t\tif(!rewritten)\r\n\t\t\t{\r\n\t\t\t\tvar query = Query(specification);\r\n\t\t\t\tif (limit != null && limit.Value >= 0)\r\n\t\t\t\t\tquery = query.Take(limit.Value);\r\n\t\t\t\tif (offset != null && offset.Value >= 0)\r\n\t\t\t\t\tquery = query.Skip(offset.Value);\r\n\t\t\t\tresult.AddRange(query);\r\n\t\t\t}\r\n\r\n\t\t\treturn result.ToArray();\r\n\t\t}\r\n\r\n\t\tpublic myModule.A[] Find(IEnumerable<string> uris)\r\n\t\t{\r\n\t\t\tif(uris == null || !uris.Any(it => it != null))\r\n\t\t\t\treturn new myModule.A[0];\r\n\r\n\t\t\tvar pks = uris.Where(it => it != null).ToList();\r\n\t\t\tvar formattedUris = NGS.DatabasePersistence.Postgres.PostgresRecordConverter.BuildSimpleUriList(pks);\r\n\t\t\tvar result = new List<myModule.A>(pks.Count);\r\n\t\t\tDatabaseQuery.Execute(\r\n\t\t\t\t@\"SELECT r FROM \"\"myModule\"\".\"\"A_entity\"\" r WHERE r.\"\"ID\"\" IN (\" + formattedUris + \")\",\r\n\t\t\t\tdr =>\r\n\t\t\t\t{\r\n\t\t\t\t\tvar _pg = dr.GetValue(0);\r\n\t\t\t\t\tusing(var _tr = _pg as System.IO.TextReader ?? new System.IO.StringReader(_pg as string))\r\n\t\t\t\t\t\tresult.Add(_DatabaseCommon.FactorymyModule_A.AConverter.CreateFromRecord(_tr, 0, Locator));\r\n\t\t\t\t});\r\n\r\n\t\t\treturn result.ToArray();\r\n\t\t}\r\n\r\n\t\tprivate readonly WeakCache<myModule.A> DataCache;\r\n\t\tprivate readonly System.Collections.Concurrent.ConcurrentQueue<NotifyInfo> NotifyQueue = new System.Collections.Concurrent.ConcurrentQueue<NotifyInfo>();\r\n\t\tprivate readonly IEagerNotification Notifications;\r\n\r\n\t\tpublic string[] Persist(IEnumerable<myModule.A> insert, IEnumerable<KeyValuePair<myModule.A, myModule.A>> update, IEnumerable<myModule.A> delete)\r\n\t\t{\r\n\t\t\tvar insertedData = insert != null ? insert.ToArray() : new myModule.A[0];\r\n\t\t\tvar updatedData = update != null ? update.ToList() : new List<KeyValuePair<myModule.A, myModule.A>>();\r\n\t\t\tvar deletedData = delete != null ? delete.ToArray() : new myModule.A[0];\r\n\r\n\t\t\tif(insertedData.Length == 0 && updatedData.Count == 0 && deletedData.Length == 0)\r\n\t\t\t\treturn new string[0];\r\n\r\n\t\t\tif (updatedData.Count > 0 && updatedData.Any(it => it.Key == null))\r\n\t\t\t{\r\n\t\t\t\t//TODO fetch only null values\r\n\t\t\t\tvar oldValues = Find(updatedData.Select(it => it.Value.URI)).ToDictionary(it => it.URI);\r\n\t\t\t\tif (oldValues.Count != updatedData.Count)\r\n\t\t\t\t\tthrow new ArgumentException(\"Can't find update value. Requested: {0}, found: {1}. Missing: {2}\".With(\r\n\t\t\t\t\t\tupdatedData.Count,\r\n\t\t\t\t\t\toldValues.Count,\r\n\t\t\t\t\t\tstring.Join(\", \", updatedData.Select(it => it.Value.URI).Except(oldValues.Keys))));\r\n\t\t\t\tmyModule.A _val;\r\n\t\t\t\tfor(int i = 0; i < updatedData.Count; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\t_val = updatedData[i].Value;\r\n\t\t\t\t\tupdatedData[i] = new KeyValuePair<myModule.A, myModule.A>(oldValues[_val.URI], _val);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tupdatedData.RemoveAll(kv => kv.Key.Equals(kv.Value));\r\n\r\n\t\t\tDatabaseQuery.Fill<myModule.A, int>(insertedData, @\"nextval('\"\"myModule\"\".\"\"A_ID_seq\"\"'::regclass)::int\", (it, seq) => it.ID = seq);\r\n\r\n\t\t\tforeach(var it in insertedData)\r\n\t\t\t\tit.Validate();\r\n\t\t\tforeach(var it in updatedData)\r\n\t\t\t\tit.Value.Validate();\r\n\t\t\tforeach(var it in deletedData)\r\n\t\t\t\tit.Validate();\r\n\t\t\tfor(int i = 0; i < insertedData.Length; i++)\r\n\t\t\t\tinsertedData[i].__InternalPrepareInsert();\r\n\t\t\tforeach(var it in updatedData)\r\n\t\t\t\tit.Value.__InternalPrepareUpdate();\r\n\t\t\tfor(int i = 0; i < deletedData.Length; i++)\r\n\t\t\t\tdeletedData[i].__InternalPrepareDelete();\r\n\r\n\t\t\tfor(int i = 0; i < insertedData.Length; i++)\r\n\t\t\t{\r\n\t\t\t\tvar it = insertedData[i];\r\n\r\n\t\t\t\tit.URI = _DatabaseCommon.FactorymyModule_A.AConverter.BuildURI(it.ID);\r\n\t\t\t}\r\n\t\t\tforeach(var kv in updatedData)\r\n\t\t\t{\r\n\r\n\t\t\t\tkv.Value.URI = _DatabaseCommon.FactorymyModule_A.AConverter.BuildURI(kv.Value.ID);\r\n\t\t\t}\r\n\r\n\t\t\t_InternalDoPersist(insertedData, updatedData, deletedData);\r\n\t\t\tvar resultURI = new string[insertedData.Length];\r\n\t\t\tfor(int i = 0; i < resultURI.Length; i++)\r\n\t\t\t\tresultURI[i] = insertedData[i].URI;\r\n\r\n\t\t\tif (DatabaseQuery.InTransaction)\r\n\t\t\t{\r\n\t\t\t\tif (insertedData.Length > 0) NotifyQueue.Enqueue(new NotifyInfo(\"myModule.A\", NotifyInfo.OperationEnum.Insert, resultURI));\r\n\t\t\t\tif (updatedData.Count > 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tNotifyQueue.Enqueue(new NotifyInfo(\"myModule.A\", NotifyInfo.OperationEnum.Update, updatedData.Select(it => it.Key.URI).ToArray()));\r\n\t\t\t\t\tif (updatedData.Any(kv => kv.Key.URI != kv.Value.URI)) NotifyQueue.Enqueue(new NotifyInfo(\"myModule.A\", NotifyInfo.OperationEnum.Change, updatedData.Where(kv => kv.Key.URI != kv.Value.URI).Select(it => it.Value.URI).ToArray()));\r\n\t\t\t\t}\r\n\t\t\t\tif (deletedData.Length > 0) NotifyQueue.Enqueue(new NotifyInfo(\"myModule.A\", NotifyInfo.OperationEnum.Delete, deletedData.Select(it => it.URI).ToArray()));\r\n\t\t\t\tDataCache.Invalidate(updatedData.Select(it => it.Key.URI).Union(deletedData.Select(it => it.URI)));\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tif (insertedData.Length > 0) Notifications.Notify(new NotifyInfo(\"myModule.A\", NotifyInfo.OperationEnum.Insert, resultURI));\r\n\t\t\t\tif (updatedData.Count > 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tNotifications.Notify(new NotifyInfo(\"myModule.A\", NotifyInfo.OperationEnum.Update, updatedData.Select(it => it.Key.URI).ToArray()));\r\n\t\t\t\t\tif (updatedData.Any(kv => kv.Key.URI != kv.Value.URI)) Notifications.Notify(new NotifyInfo(\"myModule.A\", NotifyInfo.OperationEnum.Change, updatedData.Where(kv => kv.Key.URI != kv.Value.URI).Select(it => it.Value.URI).ToArray()));\r\n\t\t\t\t}\r\n\t\t\t\tif (deletedData.Length > 0) Notifications.Notify(new NotifyInfo(\"myModule.A\", NotifyInfo.OperationEnum.Delete, deletedData.Select(it => it.URI).ToArray()));\r\n\t\t\t}\r\n\r\n\t\t\treturn resultURI;\r\n\t\t}\r\n\r\n\t\tprivate readonly IPostgresTypeConverter TypeConverter = new _DatabaseCommon.FactorymyModule_A.AConverter();\r\n\r\n\t\tprivate void _InternalDoPersist(myModule.A[] insertedData, List<KeyValuePair<myModule.A, myModule.A>> updatedData, myModule.A[] deletedData)\r\n\t\t{\r\n\t\t\tusing(var cms = ChunkedMemoryStream.Create())\r\n\t\t\t{\r\n\t\t\t\tvar sw = cms.GetWriter();\r\n\t\t\t\tsw.Write(\"SELECT \\\"myModule\\\".\\\"persist_A\\\"(\");\r\n\t\t\t\tPostgresTypedArray.ToArray(sw, insertedData, _DatabaseCommon.FactorymyModule_A.AConverter.CreateTupleFrom);\r\n\t\t\t\tsw.Write(@\"::\"\"myModule\"\".\"\"A_entity\"\"[],\");\r\n\t\t\t\tPostgresTypedArray.ToArray(sw, updatedData.Select(it => it.Key), _DatabaseCommon.FactorymyModule_A.AConverter.CreateTupleFrom);\r\n\t\t\t\tsw.Write(@\"::\"\"myModule\"\".\"\"A_entity\"\"[],\");\r\n\t\t\t\tPostgresTypedArray.ToArray(sw, updatedData.Select(it => it.Value), _DatabaseCommon.FactorymyModule_A.AConverter.CreateTupleFrom);\r\n\t\t\t\tsw.Write(@\"::\"\"myModule\"\".\"\"A_entity\"\"[],\");\r\n\t\t\t\tPostgresTypedArray.ToArray(sw, deletedData, _DatabaseCommon.FactorymyModule_A.AConverter.CreateTupleFrom);\r\n\t\t\t\tsw.Write(@\"::\"\"myModule\"\".\"\"A_entity\"\"[]\");\r\n\r\n\t\t\t\tsw.Write(\")\");\r\n\r\n\t\t\t\tsw.Flush();\r\n\t\t\t\tcms.Position = 0;\r\n\t\t\t\tvar com = new Npgsql.NpgsqlCommand(cms);\r\n\t\t\t\tDatabaseQuery.Execute(com);\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tmyModule.A[] IAggregateRootRepository<myModule.A>.Create(int count, Action<myModule.A[]> initialize)\r\n\t\t{\r\n\t\t\tif(count < 0)\r\n\t\t\t\tthrow new ArgumentException(\"count must be positive: Provided value \" + count);\r\n\t\t\tvar roots = new myModule.A[count];\r\n\t\t\tfor(int i = 0; i < count; i++)\r\n\t\t\t\troots[i] = new myModule.A();\r\n\t\t\tif(initialize != null)\r\n\t\t\t\tinitialize(roots);\r\n\t\t\tPersist(roots, null, null);\r\n\t\t\treturn roots;\r\n\t\t}\r\n\r\n\t\tmyModule.A[] IAggregateRootRepository<myModule.A>.Update(string[] uris, Action<myModule.A[]> change)\r\n\t\t{\r\n\t\t\tvar roots = Find(uris);\r\n\t\t\tif(roots.Length != uris.Length)\r\n\t\t\t\tthrow new ArgumentException(\"Can't find myModule.A with uri: \".With(string.Join(\", \", uris)));\r\n\t\t\tif(change != null)\r\n\t\t\t{\r\n\t\t\t\tvar originals = roots.Select(it => it.Clone()).ToDictionary(it => it.URI);\r\n\t\t\t\tchange(roots);\r\n\t\t\t\tPersist(null, roots.Select(it => new KeyValuePair<myModule.A, myModule.A>(originals[it.URI], it)).ToList(), null);\r\n\t\t\t}\r\n\t\t\treturn roots;\r\n\t\t}\r\n\r\n\t\tvoid IAggregateRootRepository<myModule.A>.Delete(string[] uris)\r\n\t\t{\r\n\t\t\tvar roots = Find(uris);\r\n\t\t\tif(roots.Length != uris.Length)\r\n\t\t\t\tthrow new ArgumentException(\"Can't find myModule.A with uri: \".With(string.Join(\", \", uris)));\r\n\t\t\tPersist(null, null, roots);\r\n\t\t}\r\n\r\n\t\tIQueryable<myModule.A> IQueryableRepository<myModule.A>.Query<TCondition>(ISpecification<TCondition> specification)\r\n\t\t{\r\n\t\t\treturn Query(specification);\r\n\t\t}\r\n\r\n\t\tmyModule.A[] IQueryableRepository<myModule.A>.Search<TCondition>(ISpecification<TCondition> specification, int? limit, int? offset)\r\n\t\t{\r\n\t\t\treturn Search(specification, limit, offset);\r\n\t\t}\r\n\r\n\t\tmyModule.A[] IRepository<myModule.A>.Find(IEnumerable<string> uris) { return Find(uris); }\r\n\t}\r\n\r\n}\r\n","CSharpServer/myModule.B.cs":"\r\nnamespace myModule\r\n{\r\n\tusing System;\r\n\tusing System.Collections.Generic;\r\n\tusing System.Linq;\r\n\tusing System.Linq.Expressions;\r\n\tusing System.Text;\r\n\tusing System.Threading;\r\n\tusing System.Runtime.Serialization;\r\n\tusing NGS;\r\n\tusing NGS.DomainPatterns;\r\n\tusing NGS.Extensibility;\r\n\r\n\t[Serializable]\r\n\t[DataContract(Namespace=\"\")] public partial class B : System.ICloneable, NGS.DomainPatterns.IEntity, IEquatable<B>, NGS.DomainPatterns.IAggregateRoot, NGS.DomainPatterns.ICacheable, IChangeTracking<B>, NGS.Serialization.IJsonObject\r\n\t{\r\n\r\n\t\tpublic override string ToString()\r\n\t\t{\r\n\r\n\t\t\treturn base.ToString();\r\n\t\t}\r\n\r\n\t\t[System.Runtime.Serialization.OnDeserialized]\r\n\t\tprivate void OnDeserialized(StreamingContext context)\r\n\t\t{\r\n\r\n\t\t\tvar locator = context.Context as IServiceLocator;\r\n\t\t\tif (locator == null) return;\r\n\t\t\t__DataCachea = new Lazy<IDataCache<myModule.A>>(() => locator.Resolve<IDataCache<myModule.A>>());\r\n\t\t\tif(aURI == null) throw new ArgumentException(\"In entity myModule.B, property a can't be null. aURI provided as null\");\r\n\t\t}\r\n\r\n\t\tinternal long _InternalGetSizeApproximation()\r\n\t\t{\r\n\t\t\tlong size = 30;\r\n\t\t\treturn size;\r\n\t\t}\r\n\r\n\t\tinternal void __InternalPrepareInsert() {}\r\n\t\tinternal void __InternalPrepareUpdate() {}\r\n\t\tinternal void __InternalPrepareDelete() {}\r\n\t\tobject ICloneable.Clone() { return Clone(); }\r\n\r\n\t\tinternal void __ReapplyReferences()\r\n\t\t{\r\n\t\t\tif (_a != null && _a.URI != aURI) this.a = _a;\r\n\t\t}\r\n\t\t[DataMember] public string URI { get; internal set; }\r\n\r\n\t\tpublic B()\r\n\r\n\t\t{\r\n\r\n\t\t\tthis.URI = Guid.NewGuid().ToString();\r\n\t\t}\r\n\r\n\t\tbool IEquatable<IEntity>.Equals(IEntity obj)\r\n\t\t{\r\n\t\t\tvar other = obj as B;\r\n\t\t\treturn other != null\r\n\r\n\t\t\t\t&& other.ID == this.ID\r\n\t\t\t;\r\n\t\t}\r\n\r\n\t\tpublic override int GetHashCode()\r\n\t\t{\r\n\t\t\treturn this.URI != null ? this.URI.GetHashCode() : base.GetHashCode();\r\n\t\t}\r\n\r\n\t\tpublic B Clone()\r\n\t\t{\r\n\t\t\tvar item = new B\r\n\t\t\t{\r\n\t\t\t\tURI = this.URI,\r\n\r\n\t\t\t\tID = this.ID,\r\n\t\t\t\t_aURI = this._aURI, _a = this._a,\r\n\t\t\t\taID = this.aID,\r\n\t\t\t\ti = this.i,\r\n\t\t\t\ts = this.s,\r\n\t\t\t\tf = this.f,\r\n\t\t\t};\r\n\r\n\t\t\treturn item;\r\n\t\t}\r\n\t\t//TODO let's leave it out for now\r\n\t\t//public override bool Equals(object other) { return Equals(other as B); }\r\n\t\tpublic bool Equals(B other)\r\n\t\t{\r\n\t\t\treturn (this as IEquatable<IEntity>).Equals(other)\r\n\t\t\t\t&& other.URI == this.URI\r\n\r\n\t\t\t\t&& other.ID == this.ID\r\n\t\t\t\t&& this._aURI == other._aURI\r\n\t\t\t\t&& other.aID == this.aID\r\n\t\t\t\t&& other.i == this.i\r\n\t\t\t\t&& other.s == this.s\r\n\t\t\t\t&& Equals(other.f, this.f)\r\n\t\t\t;\r\n\t\t}\r\n\r\n\t\t[DataMember(EmitDefaultValue=false,Name=\"ID\")]\r\n\t\tinternal int _ID  = NumberCounter<B>.GetNextTempInt();\r\n\r\n\t\tpublic int ID\r\n\t\t{\r\n\r\n\t\t\tget\r\n\t\t\t{\r\n\r\n\t\t\t\treturn this._ID;\r\n\t\t\t}\r\n\t\t\tinternal\r\n\t\t\tset\r\n\t\t\t{\r\n\r\n\t\t\t\tthis._ID = value;\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tDictionary<System.Type, IEnumerable<string>> ICacheable.GetRelationships()\r\n\t\t{\r\n\r\n\t\t\tvar result = new List<KeyValuePair<System.Type, string>>();\r\n\r\n\t\t\tresult.AddRange(\r\n\t\t\t\tfrom it in new [] { this }\r\n\t\t\t\tlet it_a = it.aURI\r\n\t\t\t\twhere it_a != null\r\n\t\t\t\tselect new KeyValuePair<System.Type, string>(typeof(myModule.A), it_a));\r\n\t\t\treturn result.GroupBy(it => it.Key).ToDictionary(it => it.Key, it => it.Select(e => e.Value));\r\n\r\n\t\t}\r\n\r\n\t\tpublic static event Action<B> Validating = a => {};\r\n\t\tpublic void Validate()\r\n\t\t{\r\n\t\t\tValidating(this);\r\n\t\t}\r\n\t\tinternal Lazy<IDataCache<myModule.A>> __DataCachea;\r\n\r\n\t\tinternal string _aURI;\r\n\t\t[DataMember]\r\n\t\tpublic string aURI\r\n\t\t{\r\n\t\t\tget { return _aURI; }\r\n\t\t\tprivate set { _aURI = value; } //TODO: fakin serialization\r\n\t\t}\r\n\r\n\t\tinternal myModule.A _a ;\r\n\r\n\t\tpublic myModule.A a\r\n\t\t{\r\n\r\n\t\t\tget\r\n\t\t\t{\r\n\r\n\t\t\t\tif (_a != null && _a.URI != _aURI || _a == null && _aURI != null)\r\n\t\t\t\t\tif(__DataCachea != null)\r\n\t\t\t\t\t\t_a = __DataCachea.Value.Find(_aURI);\r\n\r\n\t\t\t\tif (_aURI == null && _a != null)\r\n\t\t\t\t\t_a = null;\r\n\t\t\t\treturn this._a;\r\n\t\t\t}\r\n\r\n\t\t\tset\r\n\t\t\t{\r\n\r\n\t\t\t\tif(value == null)\r\n\t\t\t\t\tthrow new ArgumentNullException(\"Property a can't be null\");\r\n\t\t\t\tthis._a = value;\r\n\r\n\t\t\t\t_aURI = value != null ? value.URI : null;\r\n\r\n\t\t\t\tif(value == null)\r\n\t\t\t\t\tthrow new ArgumentException(\"Property aID doesn't allow null values\");\r\n\t\t\t\telse if(aID != value.ID)\r\n\t\t\t\t\taID = value.ID;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t[DataMember(EmitDefaultValue=false,Name=\"aID\")]\r\n\t\tinternal int _aID ;\r\n\r\n\t\tpublic int aID\r\n\t\t{\r\n\r\n\t\t\tget\r\n\t\t\t{\r\n\r\n\t\t\t\treturn this._aID;\r\n\t\t\t}\r\n\t\t\tinternal\r\n\t\t\tset\r\n\t\t\t{\r\n\r\n\t\t\t\tthis._aID = value;\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t[DataMember(EmitDefaultValue=false,Name=\"i\")]\r\n\t\tinternal int _i ;\r\n\r\n\t\tpublic int i\r\n\t\t{\r\n\r\n\t\t\tget\r\n\t\t\t{\r\n\r\n\t\t\t\treturn this._i;\r\n\t\t\t}\r\n\r\n\t\t\tset\r\n\t\t\t{\r\n\r\n\t\t\t\tthis._i = value;\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t[DataMember(EmitDefaultValue=false,Name=\"s\")]\r\n\t\tinternal string _s  = string.Empty;\r\n\r\n\t\tpublic string s\r\n\t\t{\r\n\r\n\t\t\tget\r\n\t\t\t{\r\n\r\n\t\t\t\treturn this._s;\r\n\t\t\t}\r\n\r\n\t\t\tset\r\n\t\t\t{\r\n\r\n\t\t\t\tthis._s = value;\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t[DataMember(EmitDefaultValue=false,Name=\"f\")]\r\n\t\tinternal float _f ;\r\n\r\n\t\tpublic float f\r\n\t\t{\r\n\r\n\t\t\tget\r\n\t\t\t{\r\n\r\n\t\t\t\treturn this._f;\r\n\t\t\t}\r\n\r\n\t\t\tset\r\n\t\t\t{\r\n\r\n\t\t\t\tthis._f = value;\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tinternal B __OriginalValue;\r\n\t\tB IChangeTracking<B>.GetOriginalValue()\r\n\t\t{\r\n\t\t\treturn __OriginalValue;\r\n\t\t}\r\n\r\n\t\tvoid global::NGS.Serialization.IJsonObject.Serialize(System.IO.StreamWriter sw, Action<System.IO.StreamWriter, object> serializer)\r\n\t\t{\r\n\r\n\t\t\tsw.Write('{');\r\n\t\t\t__SerializeJsonObject(sw, new char[36], serializer, false);\r\n\t\t\tsw.Write('}');\r\n\t\t}\r\n\r\n\t\tinternal void __SerializeJsonObject(System.IO.StreamWriter sw, char[] buffer, Action<System.IO.StreamWriter, object> serializer, bool hasWrittenProperty = false)\r\n\t\t{\r\n\r\n\t\t\tif(hasWrittenProperty) sw.Write(',');\r\n\t\t\tsw.Write(\"\\\"URI\\\":\");\r\n\t\t\tglobal::NGS.Serialization.Json.Converters.StringConverter.Serialize(URI, sw);\r\n\r\n\t\t\t\tvar __expID = this.ID;\r\n\t\t\t\tif (__expID != default(int))\r\n\t\t\t\t{\r\n\t\t\t\t\tsw.Write(\",\\\"ID\\\":\");\r\n\t\t\t\t\tglobal::NGS.Serialization.Json.Converters.NumberConverter.Serialize(__expID, sw, buffer);\r\n\t\t\t\t}\r\n\r\n\t\t\tif(aURI != null)\r\n\t\t\t{\r\n\t\t\t\tsw.Write(\",\\\"aURI\\\":\");\r\n\t\t\t\tglobal::NGS.Serialization.Json.Converters.StringConverter.Serialize(_aURI, sw);\r\n\t\t\t}\r\n\r\n\t\t\t\tvar __expaID = this.aID;\r\n\t\t\t\tif (__expaID != default(int))\r\n\t\t\t\t{\r\n\t\t\t\t\tsw.Write(\",\\\"aID\\\":\");\r\n\t\t\t\t\tglobal::NGS.Serialization.Json.Converters.NumberConverter.Serialize(__expaID, sw, buffer);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar __expi = this.i;\r\n\t\t\t\tif (__expi != default(int))\r\n\t\t\t\t{\r\n\t\t\t\t\tsw.Write(\",\\\"i\\\":\");\r\n\t\t\t\t\tglobal::NGS.Serialization.Json.Converters.NumberConverter.Serialize(__expi, sw, buffer);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar __exps = this.s;\r\n\t\t\t\tif (__exps != default(string))\r\n\t\t\t\t{\r\n\t\t\t\t\tsw.Write(\",\\\"s\\\":\");\r\n\t\t\t\t\tglobal::NGS.Serialization.Json.Converters.StringConverter.Serialize(__exps, sw);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar __expf = this.f;\r\n\t\t\t\tif (__expf != default(float))\r\n\t\t\t\t{\r\n\t\t\t\t\tsw.Write(\",\\\"f\\\":\");\r\n\t\t\t\t\tglobal::NGS.Serialization.Json.Converters.NumberConverter.Serialize(__expf, sw, buffer);\r\n\t\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n}\r\n","CSharpServer/_DatabaseCommon.FactorymyModule_B.BConverter.cs":"\r\nnamespace _DatabaseCommon.FactorymyModule_B\r\n{\r\n\tusing System;\r\n\tusing System.Collections.Generic;\r\n\tusing System.Linq;\r\n\tusing System.Linq.Expressions;\r\n\tusing System.Text;\r\n\tusing System.Threading;\r\n\tusing System.Runtime.Serialization;\r\n\tusing NGS;\r\n\tusing NGS.DomainPatterns;\r\n\tusing NGS.Extensibility;\r\n\r\n\tusing System.Globalization;\r\n\tusing System.IO;\r\n\tusing NGS.DatabasePersistence;\r\n\tusing NGS.DatabasePersistence.Postgres;\r\n\tusing NGS.DatabasePersistence.Postgres.Converters;\r\n\tusing NGS.DomainPatterns;\r\n\tusing NGS.Utility;\r\n\r\n\tinternal class BConverter : IPostgresTypeConverter\r\n\t{\r\n\t\tpublic object CreateInstance(object value, IServiceLocator locator)\r\n\t\t{\r\n\t\t\tif (value == null)\r\n\t\t\t\treturn null;\r\n\t\t\tusing(var sr = value as System.IO.TextReader ?? new System.IO.StringReader(value as string ?? value.ToString()))\r\n\t\t\t{\r\n\t\t\t\treturn CreateFromRecord(sr, 0, locator);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tpublic PostgresTuple ToTuple(object instance)\r\n\t\t{\r\n\t\t\treturn CreateTupleFrom(instance as myModule.B);\r\n\t\t}\r\n\r\n\t\tpublic static RecordTuple CreateExtendedTupleFrom(myModule.B item)\r\n\t\t{\r\n\t\t\tif(item == null)\r\n\t\t\t\treturn null;\r\n\r\n\t\t\tvar items = new PostgresTuple[ExtendedColumnCount];\r\n\r\n\t\t\titems[ExtendedProperty_URI_Index] = new ValueTuple(item.URI);\r\n\t\t\titems[ExtendedProperty_ID_Index] = _DatabaseCommon.Utility.IntegerToTuple(item.ID);\r\n\t\t\titems[ExtendedProperty_aURI_Index] = new ValueTuple(item.aURI);\r\n\t\t\titems[ExtendedProperty_aID_Index] = _DatabaseCommon.Utility.IntegerToTuple(item.aID);\r\n\t\t\titems[ExtendedProperty_i_Index] = _DatabaseCommon.Utility.IntegerToTuple(item.i);\r\n\t\t\titems[ExtendedProperty_s_Index] = _DatabaseCommon.Utility.StringToTuple(item.s);\r\n\t\t\titems[ExtendedProperty_f_Index] = _DatabaseCommon.Utility.FloatToTuple(item.f);\r\n\t\t\treturn new RecordTuple(items);\r\n\t\t}\r\n\r\n\t\tpublic static RecordTuple CreateTupleFrom(myModule.B item)\r\n\t\t{\r\n\t\t\tif(item == null)\r\n\t\t\t\treturn null;\r\n\r\n\t\t\tvar items = new PostgresTuple[ColumnCount];\r\n\r\n\t\t\titems[Property_URI_Index] = new ValueTuple(item.URI);\r\n\t\t\titems[Property_ID_Index] = _DatabaseCommon.Utility.IntegerToTuple(item.ID);\r\n\t\t\titems[Property_aURI_Index] = new ValueTuple(item.aURI);\r\n\t\t\titems[Property_aID_Index] = _DatabaseCommon.Utility.IntegerToTuple(item.aID);\r\n\t\t\titems[Property_i_Index] = _DatabaseCommon.Utility.IntegerToTuple(item.i);\r\n\t\t\titems[Property_s_Index] = _DatabaseCommon.Utility.StringToTuple(item.s);\r\n\t\t\titems[Property_f_Index] = _DatabaseCommon.Utility.FloatToTuple(item.f);\r\n\t\t\treturn new RecordTuple(items);\r\n\t\t}\r\n\r\n\t\tprivate static int ColumnCount;\r\n\t\tprivate static int ExtendedColumnCount;\r\n\r\n\t\tinternal static void InitializeProperties(System.Data.DataTable columnsInfo)\r\n\t\t{\r\n\t\t\tSystem.Data.DataRow row = null;\r\n\r\n\t\t\tColumnCount = columnsInfo.Select(\"type_schema = 'myModule' AND type_name = 'B_entity'\").Length;\r\n\t\t\tExtendedColumnCount = columnsInfo.Select(\"type_schema = 'myModule' AND type_name = '-ngs_B_type-'\").Length;\r\n\r\n\t\t\tReaderConfiguration = new Action<myModule.B, TextReader, int, IServiceLocator>[ColumnCount > 0 ? ColumnCount : 1];\r\n\t\t\tReaderExtendedConfiguration = new Action<myModule.B, TextReader, int, IServiceLocator>[ExtendedColumnCount > 0 ? ExtendedColumnCount : 1];\r\n\t\t\tfor(int i = 0;i < ColumnCount; i++)\r\n\t\t\t\tReaderConfiguration[i] = (agg, tr, c, sl) => StringConverter.Skip(tr, c);\r\n\t\t\tif(ColumnCount != ReaderConfiguration.Length)\r\n\t\t\t\tReaderConfiguration[0] = (agg, tr, c, sl) => tr.Read();\r\n\t\t\tfor(int i = 0;i < ExtendedColumnCount; i++)\r\n\t\t\t\tReaderExtendedConfiguration[i] = (agg, tr, c, sl) => StringConverter.Skip(tr, c);\r\n\t\t\tif(ExtendedColumnCount != ReaderExtendedConfiguration.Length)\r\n\t\t\t\tReaderExtendedConfiguration[0] = (agg, tr, c, sl) => tr.Read();\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"B_entity\", \"URI\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column URI in type myModule.B_entity. Check if database is out of sync with code\");\r\n\t\t\tProperty_URI_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"-ngs_B_type-\", \"URI\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column URI in type myModule.B. Check if database is out of sync with code\");\r\n\t\t\tExtendedProperty_URI_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\tReaderConfiguration[Property_URI_Index] = (item, reader, context, locator) => item.URI = StringConverter.Parse(reader, context);\r\n\r\n\t\t\tReaderExtendedConfiguration[ExtendedProperty_URI_Index] = (item, reader, context, locator) => item.URI = StringConverter.Parse(reader, context);\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"B_entity\", \"ID\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column ID in type myModule.B_entity. Check if database is out of sync with code\");\r\n\t\t\tProperty_ID_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\tReaderConfiguration[Property_ID_Index] = (item, reader, context, locator) => item._ID = _DatabaseCommon.Utility.ParseInt(reader, context);\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"-ngs_B_type-\", \"ID\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column ID in type myModule.B. Check if database is out of sync with code\");\r\n\t\t\tExtendedProperty_ID_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\tReaderExtendedConfiguration[ExtendedProperty_ID_Index] = (item, reader, context, locator) => item._ID = _DatabaseCommon.Utility.ParseInt(reader, context);\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"B_entity\", \"aURI\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column aURI in type myModule.B_entity. Check if database is out of sync with code\");\r\n\t\t\tProperty_aURI_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"-ngs_B_type-\", \"aURI\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column aURI in type myModule.B. Check if database is out of sync with code\");\r\n\t\t\tExtendedProperty_aURI_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\tReaderConfiguration[Property_aURI_Index] = (item, reader, context, locator) => item._aURI = StringConverter.Parse(reader, context);\r\n\r\n\t\t\tReaderExtendedConfiguration[ExtendedProperty_aURI_Index] = (item, reader, context, locator) => item._aURI = StringConverter.Parse(reader, context);\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"B_entity\", \"aID\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column aID in type myModule.B_entity. Check if database is out of sync with code\");\r\n\t\t\tProperty_aID_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\tReaderConfiguration[Property_aID_Index] = (item, reader, context, locator) => item._aID = _DatabaseCommon.Utility.ParseInt(reader, context);\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"-ngs_B_type-\", \"aID\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column aID in type myModule.B. Check if database is out of sync with code\");\r\n\t\t\tExtendedProperty_aID_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\tReaderExtendedConfiguration[ExtendedProperty_aID_Index] = (item, reader, context, locator) => item._aID = _DatabaseCommon.Utility.ParseInt(reader, context);\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"B_entity\", \"i\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column i in type myModule.B_entity. Check if database is out of sync with code\");\r\n\t\t\tProperty_i_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\tReaderConfiguration[Property_i_Index] = (item, reader, context, locator) => item._i = _DatabaseCommon.Utility.ParseInt(reader, context);\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"-ngs_B_type-\", \"i\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column i in type myModule.B. Check if database is out of sync with code\");\r\n\t\t\tExtendedProperty_i_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\tReaderExtendedConfiguration[ExtendedProperty_i_Index] = (item, reader, context, locator) => item._i = _DatabaseCommon.Utility.ParseInt(reader, context);\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"B_entity\", \"s\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column s in type myModule.B_entity. Check if database is out of sync with code\");\r\n\t\t\tProperty_s_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\tReaderConfiguration[Property_s_Index] = (item, reader, context, locator) => item._s = _DatabaseCommon.Utility.ParseString(reader, context);\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"-ngs_B_type-\", \"s\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column s in type myModule.B. Check if database is out of sync with code\");\r\n\t\t\tExtendedProperty_s_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\tReaderExtendedConfiguration[ExtendedProperty_s_Index] = (item, reader, context, locator) => item._s = _DatabaseCommon.Utility.ParseString(reader, context);\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"B_entity\", \"f\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column f in type myModule.B_entity. Check if database is out of sync with code\");\r\n\t\t\tProperty_f_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\tReaderConfiguration[Property_f_Index] = (item, reader, context, locator) => item._f = _DatabaseCommon.Utility.ParseFloat(reader, context);\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"-ngs_B_type-\", \"f\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column f in type myModule.B. Check if database is out of sync with code\");\r\n\t\t\tExtendedProperty_f_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\tReaderExtendedConfiguration[ExtendedProperty_f_Index] = (item, reader, context, locator) => item._f = _DatabaseCommon.Utility.ParseFloat(reader, context);\r\n\r\n\t\t}\r\n\r\n\t\tprivate static Action<myModule.B, TextReader, int, IServiceLocator>[] ReaderConfiguration;\r\n\t\tprivate static Action<myModule.B, TextReader, int, IServiceLocator>[] ReaderExtendedConfiguration;\r\n\r\n\t\tpublic static myModule.B CreateFromRecord(TextReader reader, int context, IServiceLocator locator)\r\n\t\t{\r\n\t\t\tvar cur = reader.Read();\r\n\t\t\tif (cur == ',' || cur == ')')\r\n\t\t\t\treturn null;\r\n\t\t\tvar result = CreateFromRecord(reader, context, context == 0 ? 1 : context << 1, locator);\r\n\t\t\treader.Read();\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tpublic static myModule.B CreateFromRecord(TextReader reader, int outerContext, int context, IServiceLocator locator)\r\n\t\t{\r\n\t\t\tfor (int i = 0; i < outerContext; i++)\r\n\t\t\t\treader.Read();\r\n\t\t\tvar item = new myModule.B();\r\n\t\t\tforeach (var config in ReaderConfiguration)\r\n\t\t\t\tconfig(item, reader, context, locator);\r\n\t\t\tfor (int i = 0; i < outerContext; i++)\r\n\t\t\t\treader.Read();\r\n\r\n\t\t\titem.__DataCachea = new Lazy<IDataCache<myModule.A>>(() => locator.Resolve<IDataCache<myModule.A>>());\r\n\t\t\titem.__OriginalValue = item.Clone();\r\n\t\t\treturn item;\r\n\t\t}\r\n\r\n\t\tpublic static myModule.B CreateFromExtendedRecord(TextReader reader, int context, IServiceLocator locator)\r\n\t\t{\r\n\t\t\tvar cur = reader.Read();\r\n\t\t\tif (cur == ',' || cur == ')')\r\n\t\t\t\treturn null;\r\n\t\t\tvar result = CreateFromExtendedRecord(reader, context, context == 0 ? 1 : context << 1, locator);\r\n\t\t\treader.Read();\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tpublic static myModule.B CreateFromExtendedRecord(TextReader reader, int outerContext, int context, IServiceLocator locator)\r\n\t\t{\r\n\t\t\tfor (int i = 0; i < outerContext; i++)\r\n\t\t\t\treader.Read();\r\n\t\t\tvar item = new myModule.B();\r\n\t\t\tforeach (var config in ReaderExtendedConfiguration)\r\n\t\t\t\tconfig(item, reader, context, locator);\r\n\t\t\tfor (int i = 0; i < outerContext; i++)\r\n\t\t\t\treader.Read();\r\n\r\n\t\t\titem.__DataCachea = new Lazy<IDataCache<myModule.A>>(() => locator.Resolve<IDataCache<myModule.A>>());\r\n\t\t\titem.__OriginalValue = item.Clone();\r\n\t\t\treturn item;\r\n\t\t}\r\n\r\n\t\tprivate static int Property_URI_Index;\r\n\t\tprivate static int ExtendedProperty_URI_Index;\r\n\t\tinternal static List<int> OptionalEntityReferences = new List<int>();\r\n\t\tprivate static int Property_ID_Index;\r\n\t\tprivate static int ExtendedProperty_ID_Index;\r\n\r\n\t\tinternal static string BuildURI(int ID)\r\n\t\t{\r\n\t\t\treturn _DatabaseCommon.Utility.IntegerToString(ID);\r\n\t\t}\r\n\r\n\t\tinternal static void ParseURI(IServiceLocator locator, string URI, out int ID)\r\n\t\t{\r\n\r\n\t\t\tID = _DatabaseCommon.Utility.ToInt(URI);\r\n\t\t}\r\n\t\tprivate static int Property_aURI_Index;\r\n\t\tprivate static int ExtendedProperty_aURI_Index;\r\n\t\tprivate static int Property_aID_Index;\r\n\t\tprivate static int ExtendedProperty_aID_Index;\r\n\t\tprivate static int Property_i_Index;\r\n\t\tprivate static int ExtendedProperty_i_Index;\r\n\t\tprivate static int Property_s_Index;\r\n\t\tprivate static int ExtendedProperty_s_Index;\r\n\t\tprivate static int Property_f_Index;\r\n\t\tprivate static int ExtendedProperty_f_Index;\r\n\t}\r\n}\r\n","CSharpServer/DatabaseRepositorymyModule.BRepository.cs":"\r\nnamespace DatabaseRepositorymyModule\r\n{\r\n\tusing System;\r\n\tusing System.Collections.Generic;\r\n\tusing System.Linq;\r\n\tusing System.Linq.Expressions;\r\n\tusing System.Text;\r\n\tusing System.Threading;\r\n\tusing System.Runtime.Serialization;\r\n\tusing NGS;\r\n\tusing NGS.DomainPatterns;\r\n\tusing NGS.Extensibility;\r\n\r\n\tusing NGS.Utility;\r\n\tusing System.IO;\r\n\r\n\tusing NGS.DatabasePersistence;\r\n\tusing NGS.DatabasePersistence.Postgres;\r\n\tusing NGS.DatabasePersistence.Postgres.Converters;\r\n\tusing NGS.DatabasePersistence.Postgres.QueryGeneration;\r\n\r\n\tinternal static class RegisterB\r\n\t{\r\n\t\tpublic static void Register(IObjectFactory factory)\r\n\t\t{\r\n\t\t\tfactory.RegisterType(typeof(DatabaseRepositorymyModule.BRepository));\r\n\t\t\tfactory.RegisterType(typeof(DatabaseRepositorymyModule.BRepository), typeof(IQueryableRepository<myModule.B>), InstanceScope.Context);\r\n\t\t\tfactory.RegisterFunc<IQueryable<myModule.B>>(f => f.Resolve<IQueryableRepository<myModule.B>>().Query<myModule.B>(null));\r\n\r\n\t\t\tfactory.RegisterType(typeof(DatabaseRepositorymyModule.BRepository), typeof(IRepository<myModule.B>), InstanceScope.Context);\r\n\t\t\tfactory.RegisterFunc<Func<string, myModule.B>>(f => f.Resolve<IRepository<myModule.B>>().Find);\r\n\t\t\tfactory.RegisterFunc<Func<IEnumerable<string>, myModule.B[]>>(f => f.Resolve<IRepository<myModule.B>>().Find);\r\n\t\t\tfactory.RegisterType(typeof(DatabaseRepositorymyModule.BRepository), typeof(IPersistableRepository<myModule.B>), InstanceScope.Context);\r\n\t\t\tfactory.RegisterType(typeof(DatabaseRepositorymyModule.BRepository), typeof(IPersistableRepository<myModule.B>), InstanceScope.Context);\r\n\t\t\tfactory.RegisterType(typeof(DatabaseRepositorymyModule.BRepository), typeof(IAggregateRootRepository<myModule.B>), InstanceScope.Context);\r\n\r\n\t\t}\r\n\t}\r\n\r\n\tinternal partial class BRepository : IQueryableRepository<myModule.B>, System.IDisposable, IRepository<myModule.B>, IPersistableRepository<myModule.B>, IAggregateRootRepository<myModule.B>\r\n\t{\r\n\r\n\t\tprivate readonly IServiceLocator Locator;\r\n\t\tprivate readonly IDatabaseQuery DatabaseQuery;\r\n\r\n\t\tpublic BRepository(IServiceLocator locator, IDatabaseQuery query, IEagerNotification Notifications)\r\n\r\n\t\t{\r\n\r\n\t\t\tthis.Locator = locator;\r\n\t\t\tthis.DatabaseQuery = query;\r\n\r\n\t\t\tthis.Notifications = Notifications;\r\n\t\t\tDataCache = new WeakCache<myModule.B>(this);\r\n\t\t}\r\n\r\n\t\tpublic void Dispose()\r\n\t\t{\r\n\r\n\t\t\tif (!DatabaseQuery.InTransaction)\r\n\t\t\t{\r\n\t\t\t\tNotifyInfo ni;\r\n\t\t\t\twhile (NotifyQueue.TryDequeue(out ni))\r\n\t\t\t\t\tNotifications.Notify(ni);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tpublic IQueryable<myModule.B> Query<TCondition>(ISpecification<TCondition> specification)\r\n\t\t{\r\n\t\t\tif(specification != null && specification.IsSatisfied == null)\r\n\t\t\t\tthrow new ArgumentException(\"Search predicate is not specified\");\r\n\t\t\tif(specification != null && !typeof(TCondition).IsAssignableFrom(typeof(myModule.B)))\r\n\t\t\t\tthrow new ArgumentException(\"Specification is not compatible\");\r\n\r\n\t\t\tIQueryable<myModule.B> data = new Queryable<myModule.B>(new QueryExecutor(DatabaseQuery, Locator));\r\n\t\t\tbool rewritten = false;\r\n\r\n\t\t\tif(!rewritten && specification != null)\r\n\t\t\t{\r\n\t\t\t\tvar specAsNative = specification as ISpecification<myModule.B>;\r\n\t\t\t\tif(specAsNative != null)\r\n\t\t\t\t\tdata = data.Where(specAsNative.IsSatisfied);\r\n\t\t\t\telse\r\n\t\t\t\t\tdata = data.Cast<TCondition>().Where(specification.IsSatisfied).Cast<myModule.B>();\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\t\t}\r\n\r\n\t\tpublic myModule.B[] Search<TCondition>(ISpecification<TCondition> specification, int? limit, int? offset)\r\n\t\t{\r\n\t\t\tif(specification != null && specification.IsSatisfied == null)\r\n\t\t\t\tthrow new ArgumentException(\"Search predicate is not specified\");\r\n\r\n\t\t\tbool rewritten = false;\r\n\t\t\tvar result = new List<myModule.B>();\r\n\r\n\t\t\tif(!rewritten)\r\n\t\t\t{\r\n\t\t\t\tvar query = Query(specification);\r\n\t\t\t\tif (limit != null && limit.Value >= 0)\r\n\t\t\t\t\tquery = query.Take(limit.Value);\r\n\t\t\t\tif (offset != null && offset.Value >= 0)\r\n\t\t\t\t\tquery = query.Skip(offset.Value);\r\n\t\t\t\tresult.AddRange(query);\r\n\t\t\t}\r\n\r\n\t\t\treturn result.ToArray();\r\n\t\t}\r\n\r\n\t\tpublic myModule.B[] Find(IEnumerable<string> uris)\r\n\t\t{\r\n\t\t\tif(uris == null || !uris.Any(it => it != null))\r\n\t\t\t\treturn new myModule.B[0];\r\n\r\n\t\t\tvar pks = uris.Where(it => it != null).ToList();\r\n\t\t\tvar formattedUris = NGS.DatabasePersistence.Postgres.PostgresRecordConverter.BuildSimpleUriList(pks);\r\n\t\t\tvar result = new List<myModule.B>(pks.Count);\r\n\t\t\tDatabaseQuery.Execute(\r\n\t\t\t\t@\"SELECT r FROM \"\"myModule\"\".\"\"B_entity\"\" r WHERE r.\"\"ID\"\" IN (\" + formattedUris + \")\",\r\n\t\t\t\tdr =>\r\n\t\t\t\t{\r\n\t\t\t\t\tvar _pg = dr.GetValue(0);\r\n\t\t\t\t\tusing(var _tr = _pg as System.IO.TextReader ?? new System.IO.StringReader(_pg as string))\r\n\t\t\t\t\t\tresult.Add(_DatabaseCommon.FactorymyModule_B.BConverter.CreateFromRecord(_tr, 0, Locator));\r\n\t\t\t\t});\r\n\r\n\t\t\treturn result.ToArray();\r\n\t\t}\r\n\r\n\t\tprivate readonly WeakCache<myModule.B> DataCache;\r\n\t\tprivate readonly System.Collections.Concurrent.ConcurrentQueue<NotifyInfo> NotifyQueue = new System.Collections.Concurrent.ConcurrentQueue<NotifyInfo>();\r\n\t\tprivate readonly IEagerNotification Notifications;\r\n\r\n\t\tpublic string[] Persist(IEnumerable<myModule.B> insert, IEnumerable<KeyValuePair<myModule.B, myModule.B>> update, IEnumerable<myModule.B> delete)\r\n\t\t{\r\n\t\t\tvar insertedData = insert != null ? insert.ToArray() : new myModule.B[0];\r\n\t\t\tvar updatedData = update != null ? update.ToList() : new List<KeyValuePair<myModule.B, myModule.B>>();\r\n\t\t\tvar deletedData = delete != null ? delete.ToArray() : new myModule.B[0];\r\n\r\n\t\t\tif(insertedData.Length == 0 && updatedData.Count == 0 && deletedData.Length == 0)\r\n\t\t\t\treturn new string[0];\r\n\r\n\t\t\tif (updatedData.Count > 0 && updatedData.Any(it => it.Key == null))\r\n\t\t\t{\r\n\t\t\t\t//TODO fetch only null values\r\n\t\t\t\tvar oldValues = Find(updatedData.Select(it => it.Value.URI)).ToDictionary(it => it.URI);\r\n\t\t\t\tif (oldValues.Count != updatedData.Count)\r\n\t\t\t\t\tthrow new ArgumentException(\"Can't find update value. Requested: {0}, found: {1}. Missing: {2}\".With(\r\n\t\t\t\t\t\tupdatedData.Count,\r\n\t\t\t\t\t\toldValues.Count,\r\n\t\t\t\t\t\tstring.Join(\", \", updatedData.Select(it => it.Value.URI).Except(oldValues.Keys))));\r\n\t\t\t\tmyModule.B _val;\r\n\t\t\t\tfor(int i = 0; i < updatedData.Count; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\t_val = updatedData[i].Value;\r\n\t\t\t\t\tupdatedData[i] = new KeyValuePair<myModule.B, myModule.B>(oldValues[_val.URI], _val);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tupdatedData.RemoveAll(kv => kv.Key.Equals(kv.Value));\r\n\r\n\t\t\tDatabaseQuery.Fill<myModule.B, int>(insertedData, @\"nextval('\"\"myModule\"\".\"\"B_ID_seq\"\"'::regclass)::int\", (it, seq) => it.ID = seq);\r\n\r\n\t\t\tforeach(var it in insertedData)\r\n\t\t\t\tit.Validate();\r\n\t\t\tforeach(var it in updatedData)\r\n\t\t\t\tit.Value.Validate();\r\n\t\t\tforeach(var it in deletedData)\r\n\t\t\t\tit.Validate();\r\n\t\t\tfor(int i = 0; i < insertedData.Length; i++)\r\n\t\t\t\tinsertedData[i].__InternalPrepareInsert();\r\n\t\t\tforeach(var it in updatedData)\r\n\t\t\t\tit.Value.__InternalPrepareUpdate();\r\n\t\t\tfor(int i = 0; i < deletedData.Length; i++)\r\n\t\t\t\tdeletedData[i].__InternalPrepareDelete();\r\n\r\n\t\t\tfor(int i = 0; i < insertedData.Length; i++)\r\n\t\t\t{\r\n\t\t\t\tvar it = insertedData[i];\r\n\t\t\t\tit.__ReapplyReferences();\r\n\t\t\t\tit.URI = _DatabaseCommon.FactorymyModule_B.BConverter.BuildURI(it.ID);\r\n\t\t\t\tif(it.aID != null) it._aURI = _DatabaseCommon.FactorymyModule_A.AConverter.BuildURI(it.aID);\r\n\t\t\t}\r\n\t\t\tforeach(var kv in updatedData)\r\n\t\t\t{\r\n\t\t\t\tkv.Value.__ReapplyReferences();\r\n\t\t\t\tkv.Value.URI = _DatabaseCommon.FactorymyModule_B.BConverter.BuildURI(kv.Value.ID);\r\n\t\t\t\tif(kv.Value.aID != null) kv.Value._aURI = _DatabaseCommon.FactorymyModule_A.AConverter.BuildURI(kv.Value.aID);\r\n\t\t\t}\r\n\r\n\t\t\t_InternalDoPersist(insertedData, updatedData, deletedData);\r\n\t\t\tvar resultURI = new string[insertedData.Length];\r\n\t\t\tfor(int i = 0; i < resultURI.Length; i++)\r\n\t\t\t\tresultURI[i] = insertedData[i].URI;\r\n\r\n\t\t\tif (DatabaseQuery.InTransaction)\r\n\t\t\t{\r\n\t\t\t\tif (insertedData.Length > 0) NotifyQueue.Enqueue(new NotifyInfo(\"myModule.B\", NotifyInfo.OperationEnum.Insert, resultURI));\r\n\t\t\t\tif (updatedData.Count > 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tNotifyQueue.Enqueue(new NotifyInfo(\"myModule.B\", NotifyInfo.OperationEnum.Update, updatedData.Select(it => it.Key.URI).ToArray()));\r\n\t\t\t\t\tif (updatedData.Any(kv => kv.Key.URI != kv.Value.URI)) NotifyQueue.Enqueue(new NotifyInfo(\"myModule.B\", NotifyInfo.OperationEnum.Change, updatedData.Where(kv => kv.Key.URI != kv.Value.URI).Select(it => it.Value.URI).ToArray()));\r\n\t\t\t\t}\r\n\t\t\t\tif (deletedData.Length > 0) NotifyQueue.Enqueue(new NotifyInfo(\"myModule.B\", NotifyInfo.OperationEnum.Delete, deletedData.Select(it => it.URI).ToArray()));\r\n\t\t\t\tDataCache.Invalidate(updatedData.Select(it => it.Key.URI).Union(deletedData.Select(it => it.URI)));\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tif (insertedData.Length > 0) Notifications.Notify(new NotifyInfo(\"myModule.B\", NotifyInfo.OperationEnum.Insert, resultURI));\r\n\t\t\t\tif (updatedData.Count > 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tNotifications.Notify(new NotifyInfo(\"myModule.B\", NotifyInfo.OperationEnum.Update, updatedData.Select(it => it.Key.URI).ToArray()));\r\n\t\t\t\t\tif (updatedData.Any(kv => kv.Key.URI != kv.Value.URI)) Notifications.Notify(new NotifyInfo(\"myModule.B\", NotifyInfo.OperationEnum.Change, updatedData.Where(kv => kv.Key.URI != kv.Value.URI).Select(it => it.Value.URI).ToArray()));\r\n\t\t\t\t}\r\n\t\t\t\tif (deletedData.Length > 0) Notifications.Notify(new NotifyInfo(\"myModule.B\", NotifyInfo.OperationEnum.Delete, deletedData.Select(it => it.URI).ToArray()));\r\n\t\t\t}\r\n\r\n\t\t\treturn resultURI;\r\n\t\t}\r\n\r\n\t\tprivate readonly IPostgresTypeConverter TypeConverter = new _DatabaseCommon.FactorymyModule_B.BConverter();\r\n\r\n\t\tprivate void _InternalDoPersist(myModule.B[] insertedData, List<KeyValuePair<myModule.B, myModule.B>> updatedData, myModule.B[] deletedData)\r\n\t\t{\r\n\t\t\tusing(var cms = ChunkedMemoryStream.Create())\r\n\t\t\t{\r\n\t\t\t\tvar sw = cms.GetWriter();\r\n\t\t\t\tsw.Write(\"SELECT \\\"myModule\\\".\\\"persist_B\\\"(\");\r\n\t\t\t\tPostgresTypedArray.ToArray(sw, insertedData, _DatabaseCommon.FactorymyModule_B.BConverter.CreateTupleFrom);\r\n\t\t\t\tsw.Write(@\"::\"\"myModule\"\".\"\"B_entity\"\"[],\");\r\n\t\t\t\tPostgresTypedArray.ToArray(sw, updatedData.Select(it => it.Key), _DatabaseCommon.FactorymyModule_B.BConverter.CreateTupleFrom);\r\n\t\t\t\tsw.Write(@\"::\"\"myModule\"\".\"\"B_entity\"\"[],\");\r\n\t\t\t\tPostgresTypedArray.ToArray(sw, updatedData.Select(it => it.Value), _DatabaseCommon.FactorymyModule_B.BConverter.CreateTupleFrom);\r\n\t\t\t\tsw.Write(@\"::\"\"myModule\"\".\"\"B_entity\"\"[],\");\r\n\t\t\t\tPostgresTypedArray.ToArray(sw, deletedData, _DatabaseCommon.FactorymyModule_B.BConverter.CreateTupleFrom);\r\n\t\t\t\tsw.Write(@\"::\"\"myModule\"\".\"\"B_entity\"\"[]\");\r\n\r\n\t\t\t\tsw.Write(\")\");\r\n\r\n\t\t\t\tsw.Flush();\r\n\t\t\t\tcms.Position = 0;\r\n\t\t\t\tvar com = new Npgsql.NpgsqlCommand(cms);\r\n\t\t\t\tDatabaseQuery.Execute(com);\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tmyModule.B[] IAggregateRootRepository<myModule.B>.Create(int count, Action<myModule.B[]> initialize)\r\n\t\t{\r\n\t\t\tif(count < 0)\r\n\t\t\t\tthrow new ArgumentException(\"count must be positive: Provided value \" + count);\r\n\t\t\tvar roots = new myModule.B[count];\r\n\t\t\tfor(int i = 0; i < count; i++)\r\n\t\t\t\troots[i] = new myModule.B();\r\n\t\t\tif(initialize != null)\r\n\t\t\t\tinitialize(roots);\r\n\t\t\tPersist(roots, null, null);\r\n\t\t\treturn roots;\r\n\t\t}\r\n\r\n\t\tmyModule.B[] IAggregateRootRepository<myModule.B>.Update(string[] uris, Action<myModule.B[]> change)\r\n\t\t{\r\n\t\t\tvar roots = Find(uris);\r\n\t\t\tif(roots.Length != uris.Length)\r\n\t\t\t\tthrow new ArgumentException(\"Can't find myModule.B with uri: \".With(string.Join(\", \", uris)));\r\n\t\t\tif(change != null)\r\n\t\t\t{\r\n\t\t\t\tvar originals = roots.Select(it => it.Clone()).ToDictionary(it => it.URI);\r\n\t\t\t\tchange(roots);\r\n\t\t\t\tPersist(null, roots.Select(it => new KeyValuePair<myModule.B, myModule.B>(originals[it.URI], it)).ToList(), null);\r\n\t\t\t}\r\n\t\t\treturn roots;\r\n\t\t}\r\n\r\n\t\tvoid IAggregateRootRepository<myModule.B>.Delete(string[] uris)\r\n\t\t{\r\n\t\t\tvar roots = Find(uris);\r\n\t\t\tif(roots.Length != uris.Length)\r\n\t\t\t\tthrow new ArgumentException(\"Can't find myModule.B with uri: \".With(string.Join(\", \", uris)));\r\n\t\t\tPersist(null, null, roots);\r\n\t\t}\r\n\r\n\t\tIQueryable<myModule.B> IQueryableRepository<myModule.B>.Query<TCondition>(ISpecification<TCondition> specification)\r\n\t\t{\r\n\t\t\treturn Query(specification);\r\n\t\t}\r\n\r\n\t\tmyModule.B[] IQueryableRepository<myModule.B>.Search<TCondition>(ISpecification<TCondition> specification, int? limit, int? offset)\r\n\t\t{\r\n\t\t\treturn Search(specification, limit, offset);\r\n\t\t}\r\n\r\n\t\tmyModule.B[] IRepository<myModule.B>.Find(IEnumerable<string> uris) { return Find(uris); }\r\n\t}\r\n\r\n}\r\n","CSharpServer/myModule.snowBA.cs":"\r\nnamespace myModule\r\n{\r\n\tusing System;\r\n\tusing System.Collections.Generic;\r\n\tusing System.Linq;\r\n\tusing System.Linq.Expressions;\r\n\tusing System.Text;\r\n\tusing System.Threading;\r\n\tusing System.Runtime.Serialization;\r\n\tusing NGS;\r\n\tusing NGS.DomainPatterns;\r\n\tusing NGS.Extensibility;\r\n\r\n\t[Serializable]\r\n\t[DataContract(Namespace=\"\")] public partial class snowBA : NGS.DomainPatterns.IEntity, NGS.DomainPatterns.IIdentifiable, NGS.DomainPatterns.ISnowflake<myModule.B>, NGS.Serialization.IJsonObject\r\n\t{\r\n\r\n\t\tpublic override string ToString()\r\n\t\t{\r\n\r\n\t\t\treturn base.ToString();\r\n\t\t}\r\n\r\n\t\t[System.Runtime.Serialization.OnDeserialized]\r\n\t\tprivate void OnDeserialized(StreamingContext context)\r\n\t\t{\r\n\r\n\t\t\tvar locator = context.Context as IServiceLocator;\r\n\t\t\tif (locator == null) return;\r\n\t\t}\r\n\r\n\t\t[DataMember] public string URI { get; internal set; }\r\n\r\n\t\tbool IEquatable<IEntity>.Equals(IEntity other)\r\n\t\t{\r\n\t\t\tvar o = other as myModule.snowBA;\r\n\t\t\treturn o != null && o.URI == this.URI;\r\n\t\t}\r\n\r\n\t\tpublic void Update(myModule.B entity)\r\n\t\t{\r\n\r\n\t\t\tthis.URI = entity.URI;\r\n\t\t\tthis.ai = entity.a != null  ? entity.a.i : default(int);\r\n\t\t\tthis.@as = entity.a != null  ? entity.a.s : default(string);\r\n\t\t\tthis.af = entity.a != null  ? entity.a.f : default(float);\r\n\t\t\tthis.i = entity.i;\r\n\t\t\tthis.s = entity.s;\r\n\t\t\tthis.f = entity.f;\r\n\t\t}\r\n\r\n\t\t[DataMember(EmitDefaultValue=false,Name=\"ai\")]\r\n\t\tinternal int _ai ;\r\n\r\n\t\tpublic int ai\r\n\t\t{\r\n\r\n\t\t\tget\r\n\t\t\t{\r\n\r\n\t\t\t\treturn this._ai;\r\n\t\t\t}\r\n\t\t\tinternal\r\n\t\t\tset\r\n\t\t\t{\r\n\r\n\t\t\t\tthis._ai = value;\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t[DataMember(EmitDefaultValue=false,Name=\"as\")]\r\n\t\tinternal string _as ;\r\n\r\n\t\tpublic string @as\r\n\t\t{\r\n\r\n\t\t\tget\r\n\t\t\t{\r\n\r\n\t\t\t\treturn this._as;\r\n\t\t\t}\r\n\t\t\tinternal\r\n\t\t\tset\r\n\t\t\t{\r\n\r\n\t\t\t\tthis._as = value;\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t[DataMember(EmitDefaultValue=false,Name=\"af\")]\r\n\t\tinternal float _af ;\r\n\r\n\t\tpublic float af\r\n\t\t{\r\n\r\n\t\t\tget\r\n\t\t\t{\r\n\r\n\t\t\t\treturn this._af;\r\n\t\t\t}\r\n\t\t\tinternal\r\n\t\t\tset\r\n\t\t\t{\r\n\r\n\t\t\t\tthis._af = value;\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t[DataMember(EmitDefaultValue=false,Name=\"i\")]\r\n\t\tinternal int _i ;\r\n\r\n\t\tpublic int i\r\n\t\t{\r\n\r\n\t\t\tget\r\n\t\t\t{\r\n\r\n\t\t\t\treturn this._i;\r\n\t\t\t}\r\n\t\t\tinternal\r\n\t\t\tset\r\n\t\t\t{\r\n\r\n\t\t\t\tthis._i = value;\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t[DataMember(EmitDefaultValue=false,Name=\"s\")]\r\n\t\tinternal string _s ;\r\n\r\n\t\tpublic string s\r\n\t\t{\r\n\r\n\t\t\tget\r\n\t\t\t{\r\n\r\n\t\t\t\treturn this._s;\r\n\t\t\t}\r\n\t\t\tinternal\r\n\t\t\tset\r\n\t\t\t{\r\n\r\n\t\t\t\tthis._s = value;\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t[DataMember(EmitDefaultValue=false,Name=\"f\")]\r\n\t\tinternal float _f ;\r\n\r\n\t\tpublic float f\r\n\t\t{\r\n\r\n\t\t\tget\r\n\t\t\t{\r\n\r\n\t\t\t\treturn this._f;\r\n\t\t\t}\r\n\t\t\tinternal\r\n\t\t\tset\r\n\t\t\t{\r\n\r\n\t\t\t\tthis._f = value;\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvoid global::NGS.Serialization.IJsonObject.Serialize(System.IO.StreamWriter sw, Action<System.IO.StreamWriter, object> serializer)\r\n\t\t{\r\n\r\n\t\t\tsw.Write('{');\r\n\t\t\t__SerializeJsonObject(sw, new char[36], serializer, false);\r\n\t\t\tsw.Write('}');\r\n\t\t}\r\n\r\n\t\tinternal void __SerializeJsonObject(System.IO.StreamWriter sw, char[] buffer, Action<System.IO.StreamWriter, object> serializer, bool hasWrittenProperty = false)\r\n\t\t{\r\n\r\n\t\t\tif(hasWrittenProperty) sw.Write(',');\r\n\t\t\tsw.Write(\"\\\"URI\\\":\");\r\n\t\t\tglobal::NGS.Serialization.Json.Converters.StringConverter.Serialize(URI, sw);\r\n\r\n\t\t\t\tvar __expai = this.ai;\r\n\t\t\t\tif (__expai != default(int))\r\n\t\t\t\t{\r\n\t\t\t\t\tsw.Write(\",\\\"ai\\\":\");\r\n\t\t\t\t\tglobal::NGS.Serialization.Json.Converters.NumberConverter.Serialize(__expai, sw, buffer);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar __expas = this.@as;\r\n\t\t\t\tif (__expas != default(string))\r\n\t\t\t\t{\r\n\t\t\t\t\tsw.Write(\",\\\"as\\\":\");\r\n\t\t\t\t\tglobal::NGS.Serialization.Json.Converters.StringConverter.Serialize(__expas, sw);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar __expaf = this.af;\r\n\t\t\t\tif (__expaf != default(float))\r\n\t\t\t\t{\r\n\t\t\t\t\tsw.Write(\",\\\"af\\\":\");\r\n\t\t\t\t\tglobal::NGS.Serialization.Json.Converters.NumberConverter.Serialize(__expaf, sw, buffer);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar __expi = this.i;\r\n\t\t\t\tif (__expi != default(int))\r\n\t\t\t\t{\r\n\t\t\t\t\tsw.Write(\",\\\"i\\\":\");\r\n\t\t\t\t\tglobal::NGS.Serialization.Json.Converters.NumberConverter.Serialize(__expi, sw, buffer);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar __exps = this.s;\r\n\t\t\t\tif (__exps != default(string))\r\n\t\t\t\t{\r\n\t\t\t\t\tsw.Write(\",\\\"s\\\":\");\r\n\t\t\t\t\tglobal::NGS.Serialization.Json.Converters.StringConverter.Serialize(__exps, sw);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar __expf = this.f;\r\n\t\t\t\tif (__expf != default(float))\r\n\t\t\t\t{\r\n\t\t\t\t\tsw.Write(\",\\\"f\\\":\");\r\n\t\t\t\t\tglobal::NGS.Serialization.Json.Converters.NumberConverter.Serialize(__expf, sw, buffer);\r\n\t\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n}\r\n","CSharpServer/_DatabaseCommon.FactorymyModule_snowBA.snowBAConverter.cs":"\r\nnamespace _DatabaseCommon.FactorymyModule_snowBA\r\n{\r\n\tusing System;\r\n\tusing System.Collections.Generic;\r\n\tusing System.Linq;\r\n\tusing System.Linq.Expressions;\r\n\tusing System.Text;\r\n\tusing System.Threading;\r\n\tusing System.Runtime.Serialization;\r\n\tusing NGS;\r\n\tusing NGS.DomainPatterns;\r\n\tusing NGS.Extensibility;\r\n\r\n\tusing System.Globalization;\r\n\tusing System.IO;\r\n\tusing NGS.DatabasePersistence;\r\n\tusing NGS.DatabasePersistence.Postgres;\r\n\tusing NGS.DatabasePersistence.Postgres.Converters;\r\n\tusing NGS.DomainPatterns;\r\n\tusing NGS.Utility;\r\n\r\n\tinternal class snowBAConverter : IPostgresTypeConverter\r\n\t{\r\n\t\tpublic object CreateInstance(object value, IServiceLocator locator)\r\n\t\t{\r\n\t\t\tif (value == null)\r\n\t\t\t\treturn null;\r\n\t\t\tusing(var sr = value as System.IO.TextReader ?? new System.IO.StringReader(value as string ?? value.ToString()))\r\n\t\t\t{\r\n\t\t\t\treturn CreateFromRecord(sr, 0, locator);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tpublic PostgresTuple ToTuple(object instance)\r\n\t\t{\r\n\t\t\treturn CreateTupleFrom(instance as myModule.snowBA);\r\n\t\t}\r\n\r\n\t\tpublic static RecordTuple CreateExtendedTupleFrom(myModule.snowBA item)\r\n\t\t{\r\n\t\t\tif(item == null)\r\n\t\t\t\treturn null;\r\n\r\n\t\t\tvar items = new PostgresTuple[ExtendedColumnCount];\r\n\r\n\t\t\titems[ExtendedProperty_URI_Index] = new ValueTuple(item.URI);\r\n\t\t\titems[ExtendedProperty_ai_Index] = _DatabaseCommon.Utility.IntegerToTuple(item.ai);\r\n\t\t\titems[ExtendedProperty_as_Index] = _DatabaseCommon.Utility.StringToTuple(item.@as);\r\n\t\t\titems[ExtendedProperty_af_Index] = _DatabaseCommon.Utility.FloatToTuple(item.af);\r\n\t\t\titems[ExtendedProperty_i_Index] = _DatabaseCommon.Utility.IntegerToTuple(item.i);\r\n\t\t\titems[ExtendedProperty_s_Index] = _DatabaseCommon.Utility.StringToTuple(item.s);\r\n\t\t\titems[ExtendedProperty_f_Index] = _DatabaseCommon.Utility.FloatToTuple(item.f);\r\n\t\t\treturn new RecordTuple(items);\r\n\t\t}\r\n\r\n\t\tpublic static RecordTuple CreateTupleFrom(myModule.snowBA item)\r\n\t\t{\r\n\t\t\tif(item == null)\r\n\t\t\t\treturn null;\r\n\r\n\t\t\tvar items = new PostgresTuple[ColumnCount];\r\n\r\n\t\t\titems[Property_URI_Index] = new ValueTuple(item.URI);\r\n\t\t\titems[Property_ai_Index] = _DatabaseCommon.Utility.IntegerToTuple(item.ai);\r\n\t\t\titems[Property_as_Index] = _DatabaseCommon.Utility.StringToTuple(item.@as);\r\n\t\t\titems[Property_af_Index] = _DatabaseCommon.Utility.FloatToTuple(item.af);\r\n\t\t\titems[Property_i_Index] = _DatabaseCommon.Utility.IntegerToTuple(item.i);\r\n\t\t\titems[Property_s_Index] = _DatabaseCommon.Utility.StringToTuple(item.s);\r\n\t\t\titems[Property_f_Index] = _DatabaseCommon.Utility.FloatToTuple(item.f);\r\n\t\t\treturn new RecordTuple(items);\r\n\t\t}\r\n\r\n\t\tprivate static int ColumnCount;\r\n\t\tprivate static int ExtendedColumnCount;\r\n\r\n\t\tinternal static void InitializeProperties(System.Data.DataTable columnsInfo)\r\n\t\t{\r\n\t\t\tSystem.Data.DataRow row = null;\r\n\r\n\t\t\tColumnCount = columnsInfo.Select(\"type_schema = 'myModule' AND type_name = 'snowBA_snowflake'\").Length;\r\n\t\t\tExtendedColumnCount = columnsInfo.Select(\"type_schema = 'myModule' AND type_name = '-ngs_snowBA_type-'\").Length;\r\n\r\n\t\t\tReaderConfiguration = new Action<myModule.snowBA, TextReader, int, IServiceLocator>[ColumnCount > 0 ? ColumnCount : 1];\r\n\t\t\tReaderExtendedConfiguration = new Action<myModule.snowBA, TextReader, int, IServiceLocator>[ExtendedColumnCount > 0 ? ExtendedColumnCount : 1];\r\n\t\t\tfor(int i = 0;i < ColumnCount; i++)\r\n\t\t\t\tReaderConfiguration[i] = (agg, tr, c, sl) => StringConverter.Skip(tr, c);\r\n\t\t\tif(ColumnCount != ReaderConfiguration.Length)\r\n\t\t\t\tReaderConfiguration[0] = (agg, tr, c, sl) => tr.Read();\r\n\t\t\tfor(int i = 0;i < ExtendedColumnCount; i++)\r\n\t\t\t\tReaderExtendedConfiguration[i] = (agg, tr, c, sl) => StringConverter.Skip(tr, c);\r\n\t\t\tif(ExtendedColumnCount != ReaderExtendedConfiguration.Length)\r\n\t\t\t\tReaderExtendedConfiguration[0] = (agg, tr, c, sl) => tr.Read();\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"snowBA_snowflake\", \"URI\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column URI in type myModule.snowBA_snowflake. Check if database is out of sync with code\");\r\n\t\t\tProperty_URI_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"-ngs_snowBA_type-\", \"URI\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column URI in type myModule.snowBA. Check if database is out of sync with code\");\r\n\t\t\tExtendedProperty_URI_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\tReaderConfiguration[Property_URI_Index] = (item, reader, context, locator) => item.URI = StringConverter.Parse(reader, context);\r\n\r\n\t\t\tReaderExtendedConfiguration[ExtendedProperty_URI_Index] = (item, reader, context, locator) => item.URI = StringConverter.Parse(reader, context);\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"snowBA_snowflake\", \"ai\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column ai in type myModule.snowBA_snowflake. Check if database is out of sync with code\");\r\n\t\t\tProperty_ai_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\tReaderConfiguration[Property_ai_Index] = (item, reader, context, locator) => item._ai = _DatabaseCommon.Utility.ParseInt(reader, context);\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"-ngs_snowBA_type-\", \"ai\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column ai in type myModule.snowBA. Check if database is out of sync with code\");\r\n\t\t\tExtendedProperty_ai_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\tReaderExtendedConfiguration[ExtendedProperty_ai_Index] = (item, reader, context, locator) => item._ai = _DatabaseCommon.Utility.ParseInt(reader, context);\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"snowBA_snowflake\", \"as\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column as in type myModule.snowBA_snowflake. Check if database is out of sync with code\");\r\n\t\t\tProperty_as_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\tReaderConfiguration[Property_as_Index] = (item, reader, context, locator) => item._as = _DatabaseCommon.Utility.ParseString(reader, context);\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"-ngs_snowBA_type-\", \"as\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column as in type myModule.snowBA. Check if database is out of sync with code\");\r\n\t\t\tExtendedProperty_as_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\tReaderExtendedConfiguration[ExtendedProperty_as_Index] = (item, reader, context, locator) => item._as = _DatabaseCommon.Utility.ParseString(reader, context);\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"snowBA_snowflake\", \"af\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column af in type myModule.snowBA_snowflake. Check if database is out of sync with code\");\r\n\t\t\tProperty_af_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\tReaderConfiguration[Property_af_Index] = (item, reader, context, locator) => item._af = _DatabaseCommon.Utility.ParseFloat(reader, context);\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"-ngs_snowBA_type-\", \"af\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column af in type myModule.snowBA. Check if database is out of sync with code\");\r\n\t\t\tExtendedProperty_af_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\tReaderExtendedConfiguration[ExtendedProperty_af_Index] = (item, reader, context, locator) => item._af = _DatabaseCommon.Utility.ParseFloat(reader, context);\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"snowBA_snowflake\", \"i\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column i in type myModule.snowBA_snowflake. Check if database is out of sync with code\");\r\n\t\t\tProperty_i_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\tReaderConfiguration[Property_i_Index] = (item, reader, context, locator) => item._i = _DatabaseCommon.Utility.ParseInt(reader, context);\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"-ngs_snowBA_type-\", \"i\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column i in type myModule.snowBA. Check if database is out of sync with code\");\r\n\t\t\tExtendedProperty_i_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\tReaderExtendedConfiguration[ExtendedProperty_i_Index] = (item, reader, context, locator) => item._i = _DatabaseCommon.Utility.ParseInt(reader, context);\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"snowBA_snowflake\", \"s\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column s in type myModule.snowBA_snowflake. Check if database is out of sync with code\");\r\n\t\t\tProperty_s_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\tReaderConfiguration[Property_s_Index] = (item, reader, context, locator) => item._s = _DatabaseCommon.Utility.ParseString(reader, context);\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"-ngs_snowBA_type-\", \"s\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column s in type myModule.snowBA. Check if database is out of sync with code\");\r\n\t\t\tExtendedProperty_s_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\tReaderExtendedConfiguration[ExtendedProperty_s_Index] = (item, reader, context, locator) => item._s = _DatabaseCommon.Utility.ParseString(reader, context);\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"snowBA_snowflake\", \"f\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column f in type myModule.snowBA_snowflake. Check if database is out of sync with code\");\r\n\t\t\tProperty_f_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\tReaderConfiguration[Property_f_Index] = (item, reader, context, locator) => item._f = _DatabaseCommon.Utility.ParseFloat(reader, context);\r\n\r\n\t\t\trow = columnsInfo.Rows.Find(new[] { \"myModule\", \"-ngs_snowBA_type-\", \"f\" });\r\n\t\t\tif(row == null)\r\n\t\t\t\tthrow new System.Configuration.ConfigurationException(\"Couldn't find column f in type myModule.snowBA. Check if database is out of sync with code\");\r\n\t\t\tExtendedProperty_f_Index = (short)row[\"column_index\"] - 1;\r\n\r\n\t\t\tReaderExtendedConfiguration[ExtendedProperty_f_Index] = (item, reader, context, locator) => item._f = _DatabaseCommon.Utility.ParseFloat(reader, context);\r\n\r\n\t\t}\r\n\r\n\t\tprivate static Action<myModule.snowBA, TextReader, int, IServiceLocator>[] ReaderConfiguration;\r\n\t\tprivate static Action<myModule.snowBA, TextReader, int, IServiceLocator>[] ReaderExtendedConfiguration;\r\n\r\n\t\tpublic static myModule.snowBA CreateFromRecord(TextReader reader, int context, IServiceLocator locator)\r\n\t\t{\r\n\t\t\tvar cur = reader.Read();\r\n\t\t\tif (cur == ',' || cur == ')')\r\n\t\t\t\treturn null;\r\n\t\t\tvar result = CreateFromRecord(reader, context, context == 0 ? 1 : context << 1, locator);\r\n\t\t\treader.Read();\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tpublic static myModule.snowBA CreateFromRecord(TextReader reader, int outerContext, int context, IServiceLocator locator)\r\n\t\t{\r\n\t\t\tfor (int i = 0; i < outerContext; i++)\r\n\t\t\t\treader.Read();\r\n\t\t\tvar item = new myModule.snowBA();\r\n\t\t\tforeach (var config in ReaderConfiguration)\r\n\t\t\t\tconfig(item, reader, context, locator);\r\n\t\t\tfor (int i = 0; i < outerContext; i++)\r\n\t\t\t\treader.Read();\r\n\r\n\t\t\treturn item;\r\n\t\t}\r\n\r\n\t\tpublic static myModule.snowBA CreateFromExtendedRecord(TextReader reader, int context, IServiceLocator locator)\r\n\t\t{\r\n\t\t\tvar cur = reader.Read();\r\n\t\t\tif (cur == ',' || cur == ')')\r\n\t\t\t\treturn null;\r\n\t\t\tvar result = CreateFromExtendedRecord(reader, context, context == 0 ? 1 : context << 1, locator);\r\n\t\t\treader.Read();\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tpublic static myModule.snowBA CreateFromExtendedRecord(TextReader reader, int outerContext, int context, IServiceLocator locator)\r\n\t\t{\r\n\t\t\tfor (int i = 0; i < outerContext; i++)\r\n\t\t\t\treader.Read();\r\n\t\t\tvar item = new myModule.snowBA();\r\n\t\t\tforeach (var config in ReaderExtendedConfiguration)\r\n\t\t\t\tconfig(item, reader, context, locator);\r\n\t\t\tfor (int i = 0; i < outerContext; i++)\r\n\t\t\t\treader.Read();\r\n\r\n\t\t\treturn item;\r\n\t\t}\r\n\r\n\t\tprivate static int Property_URI_Index;\r\n\t\tprivate static int ExtendedProperty_URI_Index;\r\n\t\tprivate static int Property_ai_Index;\r\n\t\tprivate static int ExtendedProperty_ai_Index;\r\n\t\tprivate static int Property_as_Index;\r\n\t\tprivate static int ExtendedProperty_as_Index;\r\n\t\tprivate static int Property_af_Index;\r\n\t\tprivate static int ExtendedProperty_af_Index;\r\n\t\tprivate static int Property_i_Index;\r\n\t\tprivate static int ExtendedProperty_i_Index;\r\n\t\tprivate static int Property_s_Index;\r\n\t\tprivate static int ExtendedProperty_s_Index;\r\n\t\tprivate static int Property_f_Index;\r\n\t\tprivate static int ExtendedProperty_f_Index;\r\n\t}\r\n}\r\n","CSharpServer/DatabaseRepositorymyModule.snowBARepository.cs":"\r\nnamespace DatabaseRepositorymyModule\r\n{\r\n\tusing System;\r\n\tusing System.Collections.Generic;\r\n\tusing System.Linq;\r\n\tusing System.Linq.Expressions;\r\n\tusing System.Text;\r\n\tusing System.Threading;\r\n\tusing System.Runtime.Serialization;\r\n\tusing NGS;\r\n\tusing NGS.DomainPatterns;\r\n\tusing NGS.Extensibility;\r\n\r\n\tusing NGS.DatabasePersistence;\r\n\tusing NGS.DatabasePersistence.Postgres;\r\n\tusing NGS.DatabasePersistence.Postgres.Converters;\r\n\tusing NGS.DatabasePersistence.Postgres.QueryGeneration;\r\n\r\n\tinternal static class RegistersnowBA\r\n\t{\r\n\t\tpublic static void Register(IObjectFactory factory)\r\n\t\t{\r\n\t\t\tfactory.RegisterType(typeof(DatabaseRepositorymyModule.snowBARepository));\r\n\t\t\tfactory.RegisterType(typeof(DatabaseRepositorymyModule.snowBARepository), typeof(IQueryableRepository<myModule.snowBA>), InstanceScope.Context);\r\n\t\t\tfactory.RegisterFunc<IQueryable<myModule.snowBA>>(f => f.Resolve<IQueryableRepository<myModule.snowBA>>().Query<myModule.snowBA>(null));\r\n\r\n\t\t\tfactory.RegisterType(typeof(DatabaseRepositorymyModule.snowBARepository), typeof(IRepository<myModule.snowBA>), InstanceScope.Context);\r\n\t\t\tfactory.RegisterFunc<Func<string, myModule.snowBA>>(f => f.Resolve<IRepository<myModule.snowBA>>().Find);\r\n\t\t\tfactory.RegisterFunc<Func<IEnumerable<string>, myModule.snowBA[]>>(f => f.Resolve<IRepository<myModule.snowBA>>().Find);\r\n\r\n\t\t}\r\n\t}\r\n\r\n\tinternal partial class snowBARepository : IQueryableRepository<myModule.snowBA>, System.IDisposable, IRepository<myModule.snowBA>\r\n\t{\r\n\r\n\t\tprivate readonly IServiceLocator Locator;\r\n\t\tprivate readonly IDatabaseQuery DatabaseQuery;\r\n\r\n\t\tpublic snowBARepository(IServiceLocator locator, IDatabaseQuery query)\r\n\r\n\t\t{\r\n\r\n\t\t\tthis.Locator = locator;\r\n\t\t\tthis.DatabaseQuery = query;\r\n\t\t}\r\n\r\n\t\tpublic void Dispose() {}\r\n\r\n\t\tpublic IQueryable<myModule.snowBA> Query<TCondition>(ISpecification<TCondition> specification)\r\n\t\t{\r\n\t\t\tif(specification != null && specification.IsSatisfied == null)\r\n\t\t\t\tthrow new ArgumentException(\"Search predicate is not specified\");\r\n\r\n\t\t\tif(specification != null\r\n\t\t\t\t&& (!typeof(TCondition).IsAssignableFrom(typeof(myModule.snowBA)) && !typeof(TCondition).IsAssignableFrom(typeof(myModule.B))))\r\n\t\t\t\tthrow new ArgumentException(\"Specification is not compatible\");\r\n\r\n\t\t\tIQueryable<myModule.snowBA> data = new Queryable<myModule.snowBA>(new QueryExecutor(DatabaseQuery, Locator));\r\n\t\t\tbool rewritten = false;\r\n\r\n\t\t\tif(specification != null && typeof(TCondition).IsAssignableFrom(typeof(myModule.B)))\r\n\t\t\t{\r\n\t\t\t\trewritten = true;\r\n\t\t\t\tvar entitySpec = specification as ISpecification<myModule.B>;\r\n\t\t\t\tIQueryable<myModule.B> entities = new Queryable<myModule.B>(new QueryExecutor(DatabaseQuery, Locator));\r\n\t\t\t\tvar uris = entitySpec != null\r\n\t\t\t\t\t? entities.Where(entitySpec.IsSatisfied).Select(it => it.URI).Skip(0)\r\n\t\t\t\t\t: entities.Cast<TCondition>().Where(specification.IsSatisfied).Cast<myModule.B>().Select(it => it.URI).Skip(0);\r\n\t\t\t\tdata = data.Where(it => uris.Contains(it.URI));\r\n\t\t\t}\r\n\r\n\t\t\tif(!rewritten && specification != null)\r\n\t\t\t{\r\n\t\t\t\tvar specAsNative = specification as ISpecification<myModule.snowBA>;\r\n\t\t\t\tif(specAsNative != null)\r\n\t\t\t\t\tdata = data.Where(specAsNative.IsSatisfied);\r\n\t\t\t\telse\r\n\t\t\t\t\tdata = data.Cast<TCondition>().Where(specification.IsSatisfied).Cast<myModule.snowBA>();\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\t\t}\r\n\r\n\t\tpublic myModule.snowBA[] Search<TCondition>(ISpecification<TCondition> specification, int? limit, int? offset)\r\n\t\t{\r\n\t\t\tif(specification != null && specification.IsSatisfied == null)\r\n\t\t\t\tthrow new ArgumentException(\"Search predicate is not specified\");\r\n\r\n\t\t\tbool rewritten = false;\r\n\t\t\tvar result = new List<myModule.snowBA>();\r\n\r\n\t\t\tif(!rewritten)\r\n\t\t\t{\r\n\t\t\t\tvar query = Query(specification);\r\n\t\t\t\tif (limit != null && limit.Value >= 0)\r\n\t\t\t\t\tquery = query.Take(limit.Value);\r\n\t\t\t\tif (offset != null && offset.Value >= 0)\r\n\t\t\t\t\tquery = query.Skip(offset.Value);\r\n\t\t\t\tresult.AddRange(query);\r\n\t\t\t}\r\n\r\n\t\t\treturn result.ToArray();\r\n\t\t}\r\n\r\n\t\tpublic myModule.snowBA[] Find(IEnumerable<string> uris)\r\n\t\t{\r\n\t\t\tif(uris == null || !uris.Any(it => it != null))\r\n\t\t\t\treturn new myModule.snowBA[0];\r\n\r\n\t\t\tvar pks = uris.Where(it => it != null).ToList();\r\n\t\t\tvar result = new List<myModule.snowBA>(pks.Count);\r\n\t\t\tvar formattedUris = NGS.DatabasePersistence.Postgres.PostgresRecordConverter.BuildSimpleUriList(pks);\r\n\t\t\tDatabaseQuery.Execute(\r\n\t\t\t\t@\"SELECT r FROM \"\"myModule\"\".\"\"snowBA_snowflake\"\" r WHERE r.\"\"URI\"\" IN (\" + formattedUris + \")\",\r\n\t\t\t\tdr =>\r\n\t\t\t\t{\r\n\t\t\t\t\tvar _pg = dr.GetValue(0);\r\n\t\t\t\t\tusing(var _tr = _pg as System.IO.TextReader ?? new System.IO.StringReader(_pg as string))\r\n\t\t\t\t\t\tresult.Add(_DatabaseCommon.FactorymyModule_snowBA.snowBAConverter.CreateFromRecord(_tr, 0, Locator));\r\n\t\t\t\t});\r\n\r\n\t\t\treturn result.ToArray();\r\n\t\t}\r\n\t}\r\n}\r\n"}